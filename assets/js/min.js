async function a(){try{var o=(await(await fetch("/scores")).json()).puntuaciones,i=document.createDocumentFragment(),a=Object.values(o);for(console.log(o);S.firstChild;)S.removeChild(S.firstChild);for(index in a.sort((o,i)=>i.puntuacion-o.puntuacion),a){var e=document.createElement("li"),t=(e.classList.add("item__lista__puntuaciones"),document.createElement("p")),s=(t.textContent="#"+a[index].id,document.createElement("p")),r=new Date(a[index].fecha),n=r.getFullYear(),c=r.getMonth()<10?"0"+(+r.getMonth()+1):+r.getMonth()+1,h=r.getDay()<10?"0"+r.getDay():r.getDay(),p=r.getHours()<10?"0"+r.getHours():r.getHours(),m=r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes(),d=r.getSeconds()<10?"0"+r.getSeconds():r.getSeconds(),l=(s.textContent=n+`/${c}/${h} ${p}:${m}:`+d,document.createElement("p")),u=(l.textContent=a[index].nombre,document.createElement("p"));u.textContent=a[index].puntuacion,await e.append(t),await e.append(l),await e.append(s),await e.append(u),await i.append(e)}return await S.append(i),!0}catch(o){return o}}async function i(o){o={nombre:o.nombre,puntuacion:o.puntuacion,fecha:new Date},o=await fetch("/new-score",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(o),method:"PUT"});return!!(json=await o.json()).success}class o{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e={x:0,y:0}}){this.offset=e,this.posicion=o,this.velocidad=i,this.imagenes=a}dibujar(){}}class e extends o{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a}){super({posicion:o,velocidad:i,imagenes:a}),this.ocultar=!1,this.mapaLibro={abrirLibro:{contadorLimiteCuadros:10,frames:8},cerrarLibro:{contadorLimiteCuadros:10,frames:8,libroCerrado:!1},botonCerrar:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:10,frames:5,opacidad:0,posicion:{x:this.posicion.x+this.imagenes.abrirLibro.frame_1.width*V.proporciones.ayuda.libro-.07*this.imagenes.abrirLibro.frame_1.width*V.proporciones.ayuda.libro-this.imagenes.botonCerrar.width*V.proporciones.ayuda.cerrar,y:this.posicion.y+.27*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro},botonActivo:!1,eventoCreado:!1},botonArriba:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:24,posicion:{x:this.posicion.x+(.25*this.imagenes.abrirLibro.frame_1.width+16)*V.proporciones.ayuda.libro-this.imagenes.botonArriba.frame_1.width/2*V.proporciones.ayuda.teclas,y:this.posicion.y+.27*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro},frames:2},botonW:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:24,posicion:{x:this.posicion.x+(.75*this.imagenes.abrirLibro.frame_1.width-8)*V.proporciones.ayuda.libro-this.imagenes.botonArriba.frame_1.width/2*V.proporciones.ayuda.teclas,y:this.posicion.y+.27*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro},frames:2},botonIzquierda:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:24,frames:2,posicion:{x:this.posicion.x+(.13*this.imagenes.abrirLibro.frame_1.width+16)*V.proporciones.ayuda.libro-this.imagenes.botonIzquierda.frame_1.width/2*V.proporciones.ayuda.teclas,y:this.posicion.y+.38*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro}},botonA:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:24,posicion:{x:this.posicion.x+.63*this.imagenes.abrirLibro.frame_1.width*V.proporciones.ayuda.libro-this.imagenes.botonIzquierda.frame_1.width/2*V.proporciones.ayuda.teclas,y:this.posicion.y+.38*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro},frames:2},botonDerecha:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:24,frames:2,posicion:{x:this.posicion.x+(.5*this.imagenes.abrirLibro.frame_1.width-.13*this.imagenes.abrirLibro.frame_1.width)*V.proporciones.ayuda.libro-this.imagenes.botonDerecha.frame_1.width/2*V.proporciones.ayuda.teclas,y:this.posicion.y+.38*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro}},botonD:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:24,posicion:{x:this.posicion.x+(this.imagenes.abrirLibro.frame_1.width-16-.13*this.imagenes.abrirLibro.frame_1.width)*V.proporciones.ayuda.libro-this.imagenes.botonDerecha.frame_1.width/2*V.proporciones.ayuda.teclas,y:this.posicion.y+.38*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro},frames:2},botonEspacio:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:24,frames:2,posicion:{x:this.posicion.x+(.25*this.imagenes.abrirLibro.frame_1.width+16)*V.proporciones.ayuda.libro-this.imagenes.botonEspacio.frame_1.width/2*V.proporciones.ayuda.teclas,y:this.posicion.y+.5*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro}},botonCheck:{cuadroActual:0,contadorCuadros:0,contadorLimiteCuadros:8,frames:5,opacidad:0,botonActivo:!1,eventoCreado:!1,imagen:this.imagenes.botonUncheck,posicion:{x:this.posicion.x+this.imagenes.abrirLibro.frame_1.width*V.proporciones.ayuda.libro*.08,y:this.posicion.y+.65*this.imagenes.abrirLibro.frame_1.height*V.proporciones.ayuda.libro}}},this.contadorCuadros=0,this.cuadroActual=0,this.estado="abrirLibro",this.imagenActual=this.imagenes[this.estado].frame_1}actualizarSprite(){this.mapaLibro.cerrarLibro.libroCerrado?this.mapaLibro.botonCheck.imagen==this.imagenes.botonCheck?sessionStorage.setItem("ocultarAyuda",!0):sessionStorage.removeItem("ocultarAyuda"):this.dibujarLibro(),"abrirLibro"==this.estado&&this.cuadroActual>=this.mapaLibro[this.estado].frames-1&&(this.dibujarBotonCerrar(),this.dibujarBotonArriba(),this.dibujarBotonW(),this.dibujarBotonA(),this.dibujarBotonD(),this.dibujarBotonDerecha(),this.dibujarBotonIzquierda(),this.dibujarBotonEspacio(),this.dibujarBotonCheck()),this.animarSprite()}dibujarLibro(){D.drawImage(this.imagenActual,0,0,this.imagenActual.width,this.imagenActual.height,this.posicion.x,this.posicion.y,this.imagenActual.width*V.proporciones.ayuda.libro,this.imagenActual.height*V.proporciones.ayuda.libro)}animarSprite(){this.contadorCuadros++,this.contadorCuadros%Math.ceil(this.mapaLibro[this.estado].contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&this.cuadroActual<this.mapaLibro[this.estado].frames-1&&(this.cuadroActual++,this.imagenActual=Object.values(this.imagenes[this.estado])[this.cuadroActual],"cerrarLibro"==this.estado)&&this.cuadroActual+1>this.mapaLibro[this.estado].frames-1&&(this.mapaLibro.cerrarLibro.libroCerrado=!0)}cerrarLibro(o){o.clientX>=this.mapaLibro.botonCerrar.posicion.x+7&&o.clientX<=this.mapaLibro.botonCerrar.posicion.x-7+this.imagenes.botonCerrar.width*V.proporciones.ayuda.botonCerrar&&o.clientY>=this.mapaLibro.botonCerrar.posicion.y+7&&o.clientY<=this.mapaLibro.botonCerrar.posicion.y-7+this.imagenes.botonCerrar.height*V.proporciones.ayuda.botonCerrar&&this.mapaLibro.botonCerrar.botonActivo&&(this.estado="cerrarLibro",this.imagenActual=this.imagenActual=this.imagenes[this.estado].frame_1,this.cuadroActual=0,this.mapaLibro.botonCerrar.botonActivo=!1)}ocultarMensaje(o){o.clientX>=this.mapaLibro.botonCheck.posicion.x&&o.clientX<=this.mapaLibro.botonCheck.posicion.x+this.mapaLibro.botonCheck.imagen.width*V.proporciones.ayuda.check&&o.clientY>=this.mapaLibro.botonCheck.posicion.y&&o.clientY<=this.mapaLibro.botonCheck.posicion.y+this.mapaLibro.botonCheck.imagen.height*V.proporciones.ayuda.check&&this.mapaLibro.botonCerrar.botonActivo&&(this.mapaLibro.botonCheck.imagen==this.imagenes.botonCheck?this.mapaLibro.botonCheck.imagen=this.imagenes.botonUncheck:this.mapaLibro.botonCheck.imagen=this.imagenes.botonCheck)}dibujarBotonArriba(){this.mapaLibro.botonArriba.contadorCuadros++,this.mapaLibro.botonArriba.contadorCuadros%Math.floor(this.mapaLibro.botonArriba.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaLibro.botonArriba.cuadroActual<this.mapaLibro.botonArriba.frames-1?this.mapaLibro.botonArriba.cuadroActual++:this.mapaLibro.botonArriba.cuadroActual=0);var o=0==this.mapaLibro.botonArriba.cuadroActual?this.imagenes.botonArriba.frame_1:this.imagenes.botonArriba.frame_2;D.drawImage(o,0,0,o.width,o.height,this.mapaLibro.botonArriba.posicion.x,this.mapaLibro.botonArriba.posicion.y,o.width*V.proporciones.ayuda.teclas,o.height*V.proporciones.ayuda.teclas),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="black";D.fillText("Saltar",this.mapaLibro.botonArriba.posicion.x+this.imagenes.botonArriba.frame_1.width/2*V.proporciones.ayuda.teclas-D.measureText("Saltar").width/2,this.mapaLibro.botonArriba.posicion.y+this.imagenes.botonArriba.frame_1.height*V.proporciones.ayuda.teclas+25)}dibujarBotonW(){this.mapaLibro.botonW.contadorCuadros++,this.mapaLibro.botonW.contadorCuadros%Math.floor(this.mapaLibro.botonW.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaLibro.botonW.cuadroActual<this.mapaLibro.botonW.frames-1?this.mapaLibro.botonW.cuadroActual++:this.mapaLibro.botonW.cuadroActual=0);var o=0==this.mapaLibro.botonW.cuadroActual?this.imagenes.botonW.frame_1:this.imagenes.botonW.frame_2;D.drawImage(o,0,0,o.width,o.height,this.mapaLibro.botonW.posicion.x,this.mapaLibro.botonW.posicion.y,o.width*V.proporciones.ayuda.teclas,o.height*V.proporciones.ayuda.teclas),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="black";D.fillText("Saltar",this.mapaLibro.botonW.posicion.x+this.imagenes.botonW.frame_1.width/2*V.proporciones.ayuda.teclas-D.measureText("Saltar").width/2,this.mapaLibro.botonW.posicion.y+this.imagenes.botonW.frame_1.height*V.proporciones.ayuda.teclas+25)}dibujarBotonA(){this.mapaLibro.botonA.contadorCuadros++,this.mapaLibro.botonA.contadorCuadros%Math.floor(this.mapaLibro.botonA.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaLibro.botonA.cuadroActual<this.mapaLibro.botonA.frames-1?this.mapaLibro.botonA.cuadroActual++:this.mapaLibro.botonA.cuadroActual=0);var o=0==this.mapaLibro.botonA.cuadroActual?this.imagenes.botonA.frame_1:this.imagenes.botonA.frame_2,o=(D.drawImage(o,0,0,o.width,o.height,this.mapaLibro.botonA.posicion.x,this.mapaLibro.botonA.posicion.y,o.width*V.proporciones.ayuda.teclas,o.height*V.proporciones.ayuda.teclas),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="black","Mover Izquierda");D.fillText(o,this.mapaLibro.botonA.posicion.x+this.imagenes.botonA.frame_1.width/2*V.proporciones.ayuda.teclas-D.measureText(o).width/2,this.mapaLibro.botonA.posicion.y+this.imagenes.botonA.frame_1.height*V.proporciones.ayuda.teclas+25)}dibujarBotonD(){this.mapaLibro.botonD.contadorCuadros++,this.mapaLibro.botonD.contadorCuadros%Math.floor(this.mapaLibro.botonD.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaLibro.botonD.cuadroActual<this.mapaLibro.botonD.frames-1?this.mapaLibro.botonD.cuadroActual++:this.mapaLibro.botonD.cuadroActual=0);var o=0==this.mapaLibro.botonD.cuadroActual?this.imagenes.botonD.frame_1:this.imagenes.botonD.frame_2,o=(D.drawImage(o,0,0,o.width,o.height,this.mapaLibro.botonD.posicion.x,this.mapaLibro.botonD.posicion.y,o.width*V.proporciones.ayuda.teclas,o.height*V.proporciones.ayuda.teclas),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="black","Mover Derecha");D.fillText(o,this.mapaLibro.botonD.posicion.x+this.imagenes.botonD.frame_1.width/2*V.proporciones.ayuda.teclas-D.measureText(o).width/2,this.mapaLibro.botonD.posicion.y+this.imagenes.botonD.frame_1.height*V.proporciones.ayuda.teclas+25)}dibujarBotonDerecha(){this.mapaLibro.botonDerecha.contadorCuadros++,this.mapaLibro.botonDerecha.contadorCuadros%Math.floor(this.mapaLibro.botonDerecha.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaLibro.botonDerecha.cuadroActual<this.mapaLibro.botonDerecha.frames-1?this.mapaLibro.botonDerecha.cuadroActual++:this.mapaLibro.botonDerecha.cuadroActual=0);var o=0==this.mapaLibro.botonDerecha.cuadroActual?this.imagenes.botonDerecha.frame_1:this.imagenes.botonDerecha.frame_2,o=(D.drawImage(o,0,0,o.width,o.height,this.mapaLibro.botonDerecha.posicion.x,this.mapaLibro.botonDerecha.posicion.y,o.width*V.proporciones.ayuda.teclas,o.height*V.proporciones.ayuda.teclas),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="black","Mover Derecha");D.fillText(o,this.mapaLibro.botonDerecha.posicion.x+this.imagenes.botonDerecha.frame_1.width/2*V.proporciones.ayuda.teclas-D.measureText(o).width/2,this.mapaLibro.botonDerecha.posicion.y+this.imagenes.botonDerecha.frame_1.height*V.proporciones.ayuda.teclas+25)}dibujarBotonIzquierda(){this.mapaLibro.botonIzquierda.contadorCuadros++,this.mapaLibro.botonIzquierda.contadorCuadros%Math.floor(this.mapaLibro.botonIzquierda.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaLibro.botonIzquierda.cuadroActual<this.mapaLibro.botonIzquierda.frames-1?this.mapaLibro.botonIzquierda.cuadroActual++:this.mapaLibro.botonIzquierda.cuadroActual=0);var o=0==this.mapaLibro.botonIzquierda.cuadroActual?this.imagenes.botonIzquierda.frame_1:this.imagenes.botonIzquierda.frame_2,o=(D.drawImage(o,0,0,o.width,o.height,this.mapaLibro.botonIzquierda.posicion.x,this.mapaLibro.botonIzquierda.posicion.y,o.width*V.proporciones.ayuda.teclas,o.height*V.proporciones.ayuda.teclas),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="black","Mover Izquierda");D.fillText(o,this.mapaLibro.botonIzquierda.posicion.x+this.imagenes.botonIzquierda.frame_1.width/2*V.proporciones.ayuda.teclas-D.measureText(o).width/2,this.mapaLibro.botonIzquierda.posicion.y+this.imagenes.botonIzquierda.frame_1.height*V.proporciones.ayuda.teclas+25)}dibujarBotonEspacio(){this.mapaLibro.botonEspacio.contadorCuadros++,this.mapaLibro.botonEspacio.contadorCuadros%Math.floor(this.mapaLibro.botonEspacio.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaLibro.botonEspacio.cuadroActual<this.mapaLibro.botonEspacio.frames-1?this.mapaLibro.botonEspacio.cuadroActual++:this.mapaLibro.botonEspacio.cuadroActual=0);var o=0==this.mapaLibro.botonEspacio.cuadroActual?this.imagenes.botonEspacio.frame_1:this.imagenes.botonEspacio.frame_2;D.drawImage(o,0,0,o.width,o.height,this.mapaLibro.botonEspacio.posicion.x,this.mapaLibro.botonEspacio.posicion.y,o.width*V.proporciones.ayuda.teclas,o.height*V.proporciones.ayuda.teclas),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="black";D.fillText("Atacar",this.mapaLibro.botonEspacio.posicion.x+this.imagenes.botonEspacio.frame_1.width/2*V.proporciones.ayuda.teclas-D.measureText("Atacar").width/2,this.mapaLibro.botonEspacio.posicion.y+this.imagenes.botonEspacio.frame_1.height*V.proporciones.ayuda.teclas+25)}dibujarBotonCheck(){this.mapaLibro.botonCheck.eventoCreado||(this.mapaLibro.botonCheck.eventoCreado=!0,document.addEventListener("click",this.cerrarLibro.bind(this))),D.drawImage(this.mapaLibro.botonCheck.imagen,0,0,this.mapaLibro.botonCheck.imagen.width,this.mapaLibro.botonCheck.imagen.height,this.mapaLibro.botonCheck.posicion.x,this.mapaLibro.botonCheck.posicion.y,this.mapaLibro.botonCheck.imagen.width*V.proporciones.ayuda.check,this.mapaLibro.botonCheck.imagen.height*V.proporciones.ayuda.check),D.font=16*V.proporciones.texto+"px VT323";D.fillText("No volver a mostrar",this.mapaLibro.botonCheck.posicion.x+this.imagenes.botonCheck.width*V.proporciones.ayuda.teclas+10,this.mapaLibro.botonCheck.posicion.y+this.imagenes.botonCheck.height/2*V.proporciones.ayuda.teclas+16*V.proporciones.texto/2)}dibujarBotonCerrar(){1!=this.mapaLibro.botonCerrar.botonActivo&&(this.mapaLibro.botonCerrar.botonActivo=!0),this.mapaLibro.botonCerrar.contadorCuadros++,this.mapaLibro.botonCerrar.contadorCuadros%Math.ceil(this.mapaLibro.botonCerrar.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&this.mapaLibro.botonCerrar.cuadroActual<this.mapaLibro.botonCerrar.frames-1&&(this.mapaLibro.botonCerrar.cuadroActual++,this.mapaLibro.botonCerrar.opacidad+=.2),D.save(),D.globalAlpha=this.mapaLibro.botonCerrar.opacidad,D.drawImage(this.imagenes.botonCerrar,0,0,this.imagenes.botonCerrar.width,this.imagenes.botonCerrar.height,this.mapaLibro.botonCerrar.posicion.x,this.mapaLibro.botonCerrar.posicion.y,this.imagenes.botonCerrar.width*V.proporciones.ayuda.cerrar,this.imagenes.botonCerrar.height*V.proporciones.ayuda.cerrar),D.restore(),this.mapaLibro.botonCerrar.eventoCreado||(this.mapaLibro.botonCerrar.eventoCreado=!0,document.addEventListener("click",this.ocultarMensaje.bind(this)))}}class t extends o{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a}){super({posicion:o,velocidad:i,imagenes:a})}actualizar(){this.cambiarEstado(),!this.recibiendoDaño&&0<this.vida&&(this.rangoPersecucion()?this.perseguirJugador():0!=this.centrando&&this.centrar()),this.animarSprite(),0<this.vida?this.dibujar():this.muriendo&&(this.dibujarMuerte(),this.dibujarPuntaje())}dibujarPuntaje(){this.mapaPuntaje.contadorCuadros++,this.mapaPuntaje.contadorCuadros%Math.ceil(this.mapaPuntaje.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaPuntaje.cuadroActual<this.mapaPuntaje.frames-1?(this.mapaPuntaje.cuadroActual++,this.mapaPuntaje.y=this.posicion.y+this.offset.y+this.altoColision-V.proporciones.texto*this.mapaPuntaje.tamañoFuente,this.mapaPuntaje.tamañoFuente+=1,this.mapaPuntaje.cuadroActual>this.mapaPuntaje.frames-10&&(this.mapaPuntaje.opacidad-=.1)):(V.personaje.agregarPuntaje(this.puntaje),this.liberar=!0,this.drop&&this.drop.pocion&&this.plataforma.items.push(new s({posicion:{x:this.posicion.x,y:this.posicion.y+this.offset.y+this.altoColision-V.imagenesEnemigos.pocion.height*V.proporciones.pocion},offset:{x:6,y:0},velocidad:this.velocidad,imagenes:{pocion:V.imagenesEnemigos.pocion}})))),D.save(),D.globalAlpha=this.mapaPuntaje.opacidad,D.font=V.proporciones.texto*this.mapaPuntaje.tamañoFuente+"px VT323",D.fillStyle=this.mapaPuntaje.colorPuntaje,D.fillText("+"+this.puntaje,this.posicion.x+this.offset.x/2+this.anchoColision/2,this.mapaPuntaje.y),D.restore()}realizarGuardia(){this.tiempo+=V.deltaTiempo/1e3,this.velocidad.x=0,this.tiempo>this.tiempoInactivo&&this.tiempo<this.tiempoIzquierda?this.posicion.x+this.velocidad.x+this.offset.x/2>=this.posicionInicial-this.alcance&&(this.ultimaDireccion="izquierda",this.velocidad.x=-V.proporcionesFPS.proporcionMovimientoEnemigo):this.tiempo<this.tiempoIzquierda+this.tiempoInactivo?this.velocidad.x=0:this.tiempo>this.tiempoIzquierda+this.tiempoInactivo&&this.tiempo<this.tiempoCentrarIzquierda?this.posicion.x+this.velocidad.x+this.offset.x/2+this.anchoColision<=this.posicionInicial&&(this.ultimaDireccion="derecha",this.velocidad.x=V.proporcionesFPS.proporcionMovimientoEnemigo):this.tiempo<this.tiempoCentrarIzquierda+this.tiempoInactivo?this.velocidad.x=0:this.tiempo<this.tiempoDerecha?this.posicion.x+this.velocidad.x+this.offset.x/2+this.anchoColision<=this.posicionInicial+this.alcance&&(this.ultimaDireccion="derecha",this.velocidad.x=V.proporcionesFPS.proporcionMovimientoEnemigo):this.tiempo<this.tiempoDerecha+this.tiempoInactivo?this.velocidad.x=0:this.tiempo<this.tiempoCentrarDerecha?this.posicion.x+this.velocidad.x+this.offset.x/2>=this.posicionInicial&&(this.ultimaDireccion="izquierda",this.velocidad.x=-V.proporcionesFPS.proporcionMovimientoEnemigo):this.tiempo=0}rangoPersecucion(){return V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision>=this.posicionInicial-this.alcancePersecucion&&V.personaje.posicion.x+V.personaje.offset.x/2<this.posicionInicial+this.alcancePersecucion}perseguirJugador(){V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision>=this.posicionInicial-this.alcancePersecucion&&V.personaje.posicion.x+V.personaje.offset.x/2<this.posicionInicial+this.alcancePersecucion&&(V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision+this.alcanceAtaque*V.proporcionResolucion<this.posicion.x+this.offset.x/2?(this.ultimaDireccion="izquierda",this.velocidad.x=-V.proporcionesFPS.proporcionMovimientoEnemigo):V.personaje.posicion.x+V.personaje.offset.x/2-this.alcanceAtaque*V.proporcionResolucion>this.posicion.x+this.offset.x/2+this.anchoColision?(this.ultimaDireccion="derecha",this.velocidad.x=V.proporcionesFPS.proporcionMovimientoEnemigo):this.velocidad.x=0,this.centrando=!0)}centrar(){this.centrando&&(this.posicion.x+this.offset.x/2+this.alcance<this.posicionInicial?(this.ultimaDireccion="derecha",this.velocidad.x=V.proporcionesFPS.proporcionMovimientoEnemigo):this.posicion.x+this.offset.x/2+this.anchoColision-this.alcance>this.posicionInicial&&(this.ultimaDireccion="izquierda",this.velocidad.x=-V.proporcionesFPS.proporcionMovimientoEnemigo),this.posicion.x+this.offset.x/2+this.alcance==this.posicionInicial)&&(this.centrando=!1)}cambiarEstado(){this.vida<=0&&this.muriendo?("muerte"!=this.estado&&(this.estado="muerte",this.cuadroActual=0),this.velocidad.x=0):this.recibiendoDaño?"daño"!=this.estado&&(this.estado="daño",this.cuadroActual=0):(V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision+this.alcanceAtaque*V.proporcionResolucion>this.posicion.x+this.offset.x/2&&V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision<this.posicion.x+this.offset.x/2&&("atacar"!=this.estado&&this.tiempoVolverAtacar>=this.tiempoRecarga?(this.tiempoVolverAtacar=0,!V.personaje.invulnerable&&0<V.personaje.vida&&(this.atacando=!0,this.estado="atacar",this.cuadroActual=0)):this.tiempoVolverAtacar+=V.deltaTiempo),V.personaje.posicion.x+V.personaje.offset.x/2-this.alcanceAtaque*V.proporcionResolucion<this.posicion.x+this.offset.x/2+this.anchoColision&&V.personaje.posicion.x+V.personaje.offset.x/2>this.posicion.x+this.offset.x/2+this.anchoColision&&("atacar"!=this.estado&&this.tiempoVolverAtacar>=this.tiempoRecarga?(this.tiempoVolverAtacar=0,!V.personaje.invulnerable&&0<V.personaje.vida&&(this.atacando=!0,this.estado="atacar",this.cuadroActual=0)):this.tiempoVolverAtacar+=V.deltaTiempo),this.atacando||(0==this.velocidad.x?"inactivo"!=this.estado&&(this.cuadroActual=0,this.estado="inactivo"):(0<this.velocidad.x||this.velocidad.x<0)&&"caminar"!=this.estado&&(this.cuadroActual=0,this.estado="caminar")))}animarSprite(){this.posicion.x+this.offset.x/2+this.velocidad.x<this.plataforma.posicion.x+this.plataforma.offset.x/2?this.velocidad.x<0&&(this.velocidad.x=0):this.posicion.x+this.offset.x/2+this.anchoColision>=this.plataforma.posicion.x+this.plataforma.width-2&&0<this.velocidad.x&&(this.velocidad.x=0),this.posicion.x+=this.velocidad.x,this.posicion.y+=this.velocidad.y,this.contadorCuadros++,this.contadorCuadros%Math.ceil(this.mapa[this.estado].contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.cuadroActual<this.mapa[this.estado].frames-1?(this.cuadroActual++,"atacar"==this.estado&&0<V.personaje.vida?(2==this.cuadroActual&&this.atacar(),this.cuadroActual+1>=this.mapa[this.estado].frames-1&&(this.atacando=!1)):"atacar"==this.estado&&V.personaje.vida<=0&&this.cuadroActual+1>=this.mapa[this.estado].frames-1&&(this.atacando=!1),"daño"==this.estado&&this.cuadroActual+1>=this.mapa[this.estado].frames-1&&(this.recibiendoDaño=!1),"muerte"==this.estado&&this.cuadroActual+1>=this.mapa[this.estado].frames-1&&(this.muriendo=!1)):this.cuadroActual=0)}atacar(){V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision>=this.posicion.x+this.offset.x/2-Math.ceil(this.rectangulocolisionAtaque.ancho*V.proporcionResolucion)&&V.personaje.posicion.x+V.personaje.offset.x/2<=this.posicion.x+this.offset.x/2+this.anchoColision+Math.ceil(this.rectangulocolisionAtaque.ancho*V.proporcionResolucion)&&V.personaje.posicion.y+V.personaje.height>this.posicion.y+this.offset.y-Math.ceil(this.rectangulocolisionAtaque.alto*V.proporcionResolucion)&&V.personaje.posicion.y<this.posicion.y+this.offset.y+this.altoColision+Math.ceil(this.rectangulocolisionAtaque.alto*V.proporcionResolucion)&&V.personaje.recibirDaño(this.dañoAtaque)}"recibirDaño"(o){this.armadura<=0?this.vida-=o-this.defensa:this.armadura-=o,this.recibiendoDaño=!0,this.vida<=0&&(this.muriendo=!0)}dibujar(){let o=0;o="izquierda"===this.ultimaDireccion?(D.save(),D.scale(-1,1),-1):(D.save(),D.scale(1,1),1),D.drawImage(this.imagenes.enemigo,this.mapa[this.estado].x+this.anchoSprite*this.cuadroActual,this.mapa[this.estado].y,this.anchoSprite,this.altoSprite,this.posicion.x*o,this.posicion.y,this.ancho*o,this.alto),this.porcentajeArmadura=0<=this.armadura/this.totalArmadura?this.armadura/this.totalArmadura:0,this.porcentajeVida=0<=this.vida/this.totalVida?this.vida/this.totalVida:0,this.posicionBarrasX=this.posicion.x+this.offset.x/2,this.posicionBarrasY=this.posicion.y+this.offset.y-20,this.anchoBarras=this.anchoColision,this.altoBarras=10,D.fillStyle="black",D.fillRect(this.posicionBarrasX*o,this.posicionBarrasY,this.anchoBarras*o,this.altoBarras),D.fillStyle="#e63946",D.fillRect(this.posicionBarrasX*o,this.posicionBarrasY,this.anchoBarras*this.porcentajeVida*o,this.altoBarras),D.fillStyle="#ffb703",D.fillRect(this.posicionBarrasX*o,this.posicionBarrasY,this.anchoBarras*this.porcentajeArmadura*o,this.altoBarras),D.restore()}dibujarMuerte(){let o=0;o="izquierda"===this.ultimaDireccion?(D.save(),D.scale(-1,1),-1):(D.save(),D.scale(1,1),1),D.drawImage(this.imagenes.muerte,this.mapa[this.estado].x+this.anchoSpriteHumo*this.cuadroActual,this.mapa[this.estado].y,this.anchoSpriteHumo,this.altoSpriteHumo,(this.posicion.x+this.offset.x/2-this.anchoHumoEscalado/2+this.anchoColision/2)*o,this.posicion.y+this.offset.y+this.altoColision-this.altoHumoEscalado+this.mapa.muerte.offset.y*V.proporciones.enemigos.humo,this.anchoHumoEscalado*o,this.altoHumoEscalado),D.restore()}}class s extends o{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e}){super({posicion:o,velocidad:i,imagenes:a}),this.offset=e,this.movimiento=this.posicion.y,this.intervalo=0,this.rango=10,this.consumir=!1,this.consumido=!1,this.anchoColision=(this.imagenes.pocion.width-this.offset.x)*V.proporciones.pocion,this.altoColision=(this.imagenes.pocion.height-this.offset.y)*V.proporciones.pocion,this.liberar=!1,this.contadorLimiteMovimiento=4,this.contadorMovimiento=0,this.contadorLimiteCuadros=4,this.contadorCuadros=0,this.opacidad=1}actualizarSprite(){0<this.opacidad&&this.dibujar(),this.animarSprite()}dibujar(){D.save(),D.globalAlpha=this.opacidad,D.drawImage(this.imagenes.pocion,0,0,this.imagenes.pocion.width,this.imagenes.pocion.height,this.posicion.x,this.movimiento,this.imagenes.pocion.width*V.proporciones.pocion,this.imagenes.pocion.height*V.proporciones.pocion),D.restore()}animarSprite(){this.contadorMovimiento++,this.contadorMovimiento%Math.ceil(this.contadorLimiteMovimiento/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.movimiento=this.rango*Math.sin(.04*this.intervalo)+this.posicion.y,this.intervalo+=1),this.consumir&&(this.contadorCuadros++,this.contadorCuadros%Math.ceil(this.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0)&&(0<this.opacidad?this.opacidad-=.2:this.liberar=!0)}}class r extends t{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e={x:0,y:0},proporcion:t,vida:s,defensa:r,armadura:n,plataforma:c,puntaje:h,drop:p}){super({posicion:o,velocidad:i,imagenes:a}),this.drop=p,this.proporcion=t,this.puntaje=h,this.dañoAtaque=1,this.centrando=!1,this.liberar=!1,this.plataforma=c,this.alcance=V.proporciones.enemigos[this.proporcion].alcanceVigilar,this.alcancePersecucion=800,this.alcanceAtaque=70,this.rectangulocolisionAtaque={ancho:this.alcanceAtaque+10,alto:20},this.tiempoRecarga=200,this.tiempoVolverAtacar=200,this.cuadroActual=0,this.atacando=!1,this.muriendo=!1,this.contadorLimiteCuadros=12,this.cicloAnimacion=0,this.contadorCuadros=0,this.vida=s,this.defensa=r,this.armadura=n,this.totalArmadura=this.armadura,this.totalVida=this.vida,this.tiempo=0,this.posicionInicial=this.posicion.x,this.tiempoIzquierda=4e3,this.tiempoInactivo=2e3,this.tiempoCentrarIzquierda=8e3,this.tiempoCentrarDerecha=16e3,this.tiempoDerecha=12e3,this.offset=e,this.offset.x=e.x,this.anchoSprite=this.imagenes.enemigo.width/9,this.altoSprite=this.imagenes.enemigo.height/10,this.anchoSpriteHumo=64,this.altoSpriteHumo=64,this.anchoHumoEscalado=this.anchoSpriteHumo*V.proporciones.enemigos.humo,this.altoHumoEscalado=this.altoSpriteHumo*V.proporciones.enemigos.humo,this.ancho=this.anchoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.alto=this.altoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.anchoColision=this.ancho-this.offset.x,this.altoColision=this.alto-this.offset.y,this.ultimaDireccion="derecha",this.estado="inactivo",this.mapa={caminar:{x:0,y:95,frames:8,contadorLimiteCuadros:16},inactivo:{x:0,y:0,frames:5,contadorLimiteCuadros:16},"daño":{x:0,y:665,frames:3,contadorLimiteCuadros:62},atacar:{x:0,y:285,frames:7,contadorLimiteCuadros:16},muerte:{x:0,y:512,frames:11,contadorLimiteCuadros:16,offset:{x:0,y:24}}},this.mapaPuntaje={opacidad:1,"tamañoFuente":12,colorPuntaje:"#3d3d3d",contadorCuadros:0,cuadroActual:0,frames:30,contadorLimiteCuadros:2}}}class n extends t{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e={x:0,y:0},proporcion:t,vida:s,defensa:r,armadura:n,plataforma:c,puntaje:h,drop:p}){super({posicion:o,velocidad:i,imagenes:a}),this.drop=p,this.proporcion=t,this.puntaje=h,this.dañoAtaque=1,this.centrando=!1,this.liberar=!1,this.plataforma=c,this.alcance=V.proporciones.enemigos[this.proporcion].alcanceVigilar,this.alcancePersecucion=800,this.alcanceAtaque=70,this.rectangulocolisionAtaque={ancho:this.alcanceAtaque+10,alto:20},this.tiempoRecarga=200,this.tiempoVolverAtacar=200,this.cuadroActual=0,this.atacando=!1,this.muriendo=!1,this.contadorLimiteCuadros=12,this.cicloAnimacion=0,this.contadorCuadros=0,this.vida=s,this.defensa=r,this.armadura=n,this.totalArmadura=this.armadura,this.totalVida=this.vida,this.tiempo=0,this.posicionInicial=this.posicion.x,this.tiempoIzquierda=4e3,this.tiempoInactivo=2e3,this.tiempoCentrarIzquierda=8e3,this.tiempoCentrarDerecha=16e3,this.tiempoDerecha=12e3,this.offset=e,this.offset.x=e.x,this.anchoSprite=this.imagenes.enemigo.width/8,this.altoSprite=this.imagenes.enemigo.height/3,this.anchoSpriteHumo=64,this.altoSpriteHumo=64,this.anchoHumoEscalado=this.anchoSpriteHumo*V.proporciones.enemigos.humo,this.altoHumoEscalado=this.altoSpriteHumo*V.proporciones.enemigos.humo,this.ancho=this.anchoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.alto=this.altoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.anchoColision=this.ancho-this.offset.x,this.altoColision=this.alto-this.offset.y,this.ultimaDireccion="derecha",this.estado="inactivo",this.mapa={caminar:{x:0,y:0,frames:8,contadorLimiteCuadros:16},inactivo:{x:0,y:48,frames:5,contadorLimiteCuadros:16},"daño":{x:320,y:48,frames:3,contadorLimiteCuadros:62},atacar:{x:0,y:96,frames:7,contadorLimiteCuadros:16},muerte:{x:0,y:512,frames:11,contadorLimiteCuadros:16,offset:{x:0,y:24}}},this.mapaPuntaje={opacidad:1,"tamañoFuente":12,colorPuntaje:"#3d3d3d",contadorCuadros:0,cuadroActual:0,frames:30,contadorLimiteCuadros:2}}}class c extends t{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e={x:0,y:0},proporcion:t,vida:s,defensa:r,armadura:n,plataforma:c,puntaje:h,drop:p}){super({posicion:o,velocidad:i,imagenes:a}),this.drop=p,this.proporcion=t,this.puntaje=h,this.dañoAtaque=1,this.centrando=!1,this.liberar=!1,this.plataforma=c,this.alcance=V.proporciones.enemigos[this.proporcion].alcanceVigilar,this.alcancePersecucion=800,this.alcanceAtaque=80,this.rectangulocolisionAtaque={ancho:this.alcanceAtaque+10,alto:20},this.tiempoRecarga=100,this.tiempoVolverAtacar=100,this.cuadroActual=0,this.atacando=!1,this.muriendo=!1,this.contadorLimiteCuadros=12,this.cicloAnimacion=0,this.contadorCuadros=0,this.vida=s,this.defensa=r,this.armadura=n,this.totalArmadura=this.armadura,this.totalVida=this.vida,this.tiempo=0,this.posicionInicial=this.posicion.x,this.tiempoIzquierda=4e3,this.tiempoInactivo=2e3,this.tiempoCentrarIzquierda=8e3,this.tiempoCentrarDerecha=16e3,this.tiempoDerecha=12e3,this.offset=e,this.offset.x=e.x,this.anchoSprite=this.imagenes.enemigo.width/8,this.altoSprite=this.imagenes.enemigo.height/3,this.anchoSpriteHumo=64,this.altoSpriteHumo=64,this.anchoHumoEscalado=this.anchoSpriteHumo*V.proporciones.enemigos.humo,this.altoHumoEscalado=this.altoSpriteHumo*V.proporciones.enemigos.humo,this.ancho=this.anchoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.alto=this.altoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.anchoColision=this.ancho-this.offset.x,this.altoColision=this.alto-this.offset.y,this.ultimaDireccion="derecha",this.estado="inactivo",this.mapa={caminar:{x:0,y:0,frames:8,contadorLimiteCuadros:16},inactivo:{x:0,y:48,frames:5,contadorLimiteCuadros:16},"daño":{x:320,y:48,frames:3,contadorLimiteCuadros:62},atacar:{x:0,y:96,frames:6,contadorLimiteCuadros:16},muerte:{x:0,y:512,frames:11,contadorLimiteCuadros:16,offset:{x:0,y:24}}},this.mapaPuntaje={opacidad:1,"tamañoFuente":12,colorPuntaje:"#bf6f4a",contadorCuadros:0,cuadroActual:0,frames:30,contadorLimiteCuadros:2}}}class h extends t{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e={x:0,y:0},proporcion:t,vida:s,defensa:r,armadura:n,plataforma:c,puntaje:h,drop:p}){super({posicion:o,velocidad:i,imagenes:a}),this.drop=p,this.proporcion=t,this.puntaje=h,this.dañoAtaque=1,this.centrando=!1,this.liberar=!1,this.plataforma=c,this.alcance=V.proporciones.enemigos[this.proporcion].alcanceVigilar,this.alcancePersecucion=800,this.alcanceAtaque=70,this.rectangulocolisionAtaque={ancho:this.alcanceAtaque+10,alto:20},this.tiempoRecarga=200,this.tiempoVolverAtacar=200,this.cuadroActual=0,this.atacando=!1,this.muriendo=!1,this.contadorLimiteCuadros=12,this.cicloAnimacion=0,this.contadorCuadros=0,this.vida=s,this.defensa=r,this.armadura=n,this.totalArmadura=this.armadura,this.totalVida=this.vida,this.tiempo=0,this.posicionInicial=this.posicion.x,this.tiempoIzquierda=4e3,this.tiempoInactivo=2e3,this.tiempoCentrarIzquierda=8e3,this.tiempoCentrarDerecha=16e3,this.tiempoDerecha=12e3,this.offset=e,this.offset.x=e.x,this.anchoSprite=this.imagenes.enemigo.width/8,this.altoSprite=this.imagenes.enemigo.height/3,this.anchoSpriteHumo=64,this.altoSpriteHumo=64,this.anchoHumoEscalado=this.anchoSpriteHumo*V.proporciones.enemigos.humo,this.altoHumoEscalado=this.altoSpriteHumo*V.proporciones.enemigos.humo,this.ancho=this.anchoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.alto=this.altoSprite*V.proporciones.enemigos[this.proporcion].proporcion,this.anchoColision=this.ancho-this.offset.x,this.altoColision=this.alto-this.offset.y,this.ultimaDireccion="derecha",this.estado="inactivo",this.mapa={caminar:{x:0,y:0,frames:8,contadorLimiteCuadros:16},inactivo:{x:0,y:48,frames:5,contadorLimiteCuadros:16},"daño":{x:320,y:48,frames:3,contadorLimiteCuadros:62},atacar:{x:0,y:96,frames:7,contadorLimiteCuadros:16},muerte:{x:0,y:512,frames:11,contadorLimiteCuadros:16,offset:{x:0,y:24}}},this.mapaPuntaje={opacidad:1,"tamañoFuente":12,colorPuntaje:"#b4202a",contadorCuadros:0,cuadroActual:0,frames:30,contadorLimiteCuadros:2}}}class p extends o{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e={x:0,y:0},direccion:t,"daño":s}){super({posicion:o,velocidad:i,imagenes:a}),this.daño=s,this.offset=e,this.offset.x=e.x*V.proporciones.bolaFuego,this.offset.y=e.y*V.proporciones.bolaFuego,this.impactando=!1,this.mostrarImpacto=!0,this.direcion=t,this.mapaAtaque={bolaFuego:{ataque:{x:0,y:0,frames:60,contadorLimiteCuadros:8},impacto:{x:0,y:0,frames:4,contadorLimiteCuadros:24},estadoAtaque:"ataque"},cuadroActual:0,contadorCuados:0},this.alcanceAtaque={bolaFuego:{x:this.posicion.x,alcance:600}},this.mapaAtaque.bolaFuego.ataque.width=this.imagenes.bolaFuego.width/this.mapaAtaque.bolaFuego.ataque.frames,this.mapaAtaque.bolaFuego.ataque.height=this.imagenes.bolaFuego.height,this.mapaAtaque.bolaFuego.impacto.width=this.imagenes.impactoAtaque.width/this.mapaAtaque.bolaFuego.impacto.frames,this.mapaAtaque.bolaFuego.impacto.height=this.imagenes.impactoAtaque.height,this.anchoColision=this.mapaAtaque.bolaFuego.ataque.width*V.proporciones.bolaFuego-this.offset.x,this.altoColision=this.imagenes.bolaFuego.height*V.proporciones.bolaFuego-this.offset.y,this.liberar=!1}dibujarAtaque(){let o=0;o="izquierda"===this.direcion?(D.save(),D.scale(-1,1),-1):(D.save(),D.scale(1,1),1),D.drawImage(this.imagenes.bolaFuego,this.mapaAtaque.bolaFuego.ataque.x+this.mapaAtaque.bolaFuego.ataque.width*this.mapaAtaque.cuadroActual,this.mapaAtaque.bolaFuego.ataque.y,this.mapaAtaque.bolaFuego.ataque.width,this.mapaAtaque.bolaFuego.ataque.height,this.posicion.x*o,this.posicion.y,this.mapaAtaque.bolaFuego.ataque.width*V.proporciones.bolaFuego*o,this.mapaAtaque.bolaFuego.ataque.height*V.proporciones.bolaFuego),D.restore()}dibujarImpacto(){let o=0;o="izquierda"===this.direcion?(D.save(),D.scale(-1,1),-1):(D.save(),D.scale(1,1),1),D.drawImage(this.imagenes.impactoAtaque,this.mapaAtaque.bolaFuego.impacto.width*this.mapaAtaque.cuadroActual,this.mapaAtaque.bolaFuego.impacto.y,this.mapaAtaque.bolaFuego.impacto.width,this.mapaAtaque.bolaFuego.impacto.height,(this.posicion.x+this.offset.x*o)*o,this.posicion.y,this.mapaAtaque.bolaFuego.impacto.width*V.proporciones.impacto*o,this.mapaAtaque.bolaFuego.impacto.height*V.proporciones.impacto),D.restore()}animarAtaque(){this.mapaAtaque.contadorCuados++,this.mapaAtaque.contadorCuados%(this.mapaAtaque.bolaFuego[this.mapaAtaque.bolaFuego.estadoAtaque].contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0&&(this.mapaAtaque.cuadroActual<this.mapaAtaque.bolaFuego[this.mapaAtaque.bolaFuego.estadoAtaque].frames-1?(this.mapaAtaque.cuadroActual++,"impacto"==this.mapaAtaque.bolaFuego.estadoAtaque&&(console.log("estado impacto"),this.mapaAtaque.cuadroActual+1>=this.mapaAtaque.bolaFuego[this.mapaAtaque.bolaFuego.estadoAtaque].frames-1)&&(this.impactando=!1,this.liberar=!0)):this.mapaAtaque.cuadroActual=0)}detectarColisionEnemigo(){this.impactando||V.fondo.escenario.plataformas.forEach(o=>{o.enemigos.forEach(o=>{0<o.vida&&this.posicion.x+this.offset.x/2+this.anchoColision>=o.posicion.x+o.offset.x/2&&this.posicion.x+this.offset.x/2<=o.posicion.x+o.offset.x/2+o.anchoColision&&this.posicion.y+this.offset.y/2+this.altoColision>=o.posicion.y+o.offset.y&&this.posicion.y+this.offset.y/2<=o.posicion.y+o.offset.y+o.altoColision&&(o.vida+o.defensa-this.daño<0&&(this.mostrarImpacto=!1),this.impactando=!0,o.recibirDaño(this.daño))})})}cambiarEstado(){this.impactando&&"impacto"!=this.mapaAtaque.bolaFuego.estadoAtaque&&(this.mapaAtaque.bolaFuego.estadoAtaque="impacto",this.mapaAtaque.cuadroActual=0)}actualizarAtaque(){this.impactando&&(this.velocidad.x=0),this.posicion.x+=this.velocidad.x,(this.posicion.x+this.mapaAtaque.bolaFuego.ataque.width*V.proporciones.bolaFuego<0||this.posicion.x>q.width)&&(this.liberar=!0),this.cambiarEstado(),this.detectarColisionEnemigo(),"ataque"==this.mapaAtaque.bolaFuego.estadoAtaque?this.dibujarAtaque():"impacto"==this.mapaAtaque.bolaFuego.estadoAtaque&&this.impactando&&this.mostrarImpacto&&this.dibujarImpacto(),this.animarAtaque()}}class m extends o{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,offset:e={x:0,y:0},ataques:t}){super({posicion:o,velocidad:i,imagenes:a}),this.ataques=t,this.puntuacion="0000000",this.vidaTotal=4,this.vida=4,this.anchoVidaActual=1,this.anchoVidaTarget=1,this.energiaTotal=4,this.energia=4,this.anchoEnergiaActual=1,this.anchoEnergiaTarget=1,this.offset=e,this.width=32*V.proporciones.personaje,this.height=32*V.proporciones.personaje,this.saltando=!1,this.dobleSalto=!1,this.cayendo=!1,this.tiempoRecuperarEnergia=600,this.tiempoEnergia=0,this.recibiendoDaño=!1,this.invulnerable=!1,this.tiempoInvulnerableTranscurrido=0,this.tiempoParpadeoTranscurrido=0,this.tiempoInvulnerabilidad=1e3,this.tiempoParpadeoDaño=1e3,this.parpadeando=!1,this.parpadear=!1,this.anchoColision=this.width-this.offset.x,this.estado="inactivo",this.ultimaDireccion="derecha",this.cuadroActual=0,this.cicloAnimacion=0,this.contadorCuadros=0,this.realizandoAtaque=!1,this.mapa={inactivo:{x:0,y:0,frames:2},parpadear:{x:0,y:32,frames:2},caminando:{x:0,y:64,frames:4},corriendo:{x:0,y:96,frames:8},saltando:{x:0,y:160,frames:4},caida:{x:128,y:160,frames:4},"daño":{x:0,y:192,frames:4},muerto:{x:0,y:224,frames:8},ataque:{x:0,y:256,frames:8}},this.mapaVida={fullVida:{x:0,y:0},tresVidas:{x:51,y:0},dosVidas:{x:102,y:0},unaVida:{x:153,y:0},ceroVida:{x:204,y:0},vidaActual:"fullVida"},this.mapaEnergia={fullEnergia:{x:0,y:0},tresEnergias:{x:51,y:0},dosEnergias:{x:102,y:0},unaEnergia:{x:153,y:0},ceroEnergia:{x:204,y:0},energiaActual:"fullEnergia",cuadroActual:0,contadorLimiteCuadros:96},this.mapa.inactivo.contadorLimiteCuadros=120/this.mapa.inactivo.frames,this.mapa.parpadear.contadorLimiteCuadros=60/this.mapa.parpadear.frames,this.mapa.caminando.contadorLimiteCuadros=120/this.mapa.caminando.frames,this.mapa.corriendo.contadorLimiteCuadros=120/this.mapa.corriendo.frames,this.mapa.saltando.contadorLimiteCuadros=120/this.mapa.saltando.frames,this.mapa.caida.contadorLimiteCuadros=120/this.mapa.caida.frames,this.mapa.daño.contadorLimiteCuadros=120/this.mapa.daño.frames,this.mapa.muerto.contadorLimiteCuadros=120/this.mapa.muerto.frames,this.mapa.ataque.contadorLimiteCuadros=10/this.mapa.ataque.frames}dibujarPersonaje(){let o=0;o="izquierda"===this.ultimaDireccion?(D.save(),D.scale(-1,1),-1):(D.save(),D.scale(1,1),1),this.parpadeando&&0<this.vida&&(this.tiempoParpadeoTranscurrido<=this.tiempoParpadeoDaño&&(this.parpadear=!this.parpadear),this.parpadear)&&(D.globalAlpha=.3),D.drawImage(this.imagenes.tileset,this.mapa[this.estado].x+32*this.cuadroActual,this.mapa[this.estado].y,32,32,this.posicion.x*o,this.posicion.y,32*V.proporciones.personaje*o,32*V.proporciones.personaje),D.restore()}agregarPuntaje(o){var i;(o=parseInt(this.puntuacion)+o).toString().length<7&&(i=7-o.toString().length,this.puntuacion="0".repeat(i)+o.toString())}dibujarVidaPersonaje(){D.drawImage(this.imagenes.contenedorVida,0,0,this.imagenes.contenedorVida.width,this.imagenes.contenedorVida.height,10+25*V.proporciones.barraVida,10+6*V.proporciones.barraVida,this.imagenes.contenedorVida.width*V.proporciones.barraVida,this.imagenes.contenedorVida.height*V.proporciones.barraVida),this.anchoVidaTarget=this.vida/this.vidaTotal,D.drawImage(this.imagenes.barraVida,0,0,this.imagenes.barraVida.width,this.imagenes.barraVida.height,10+26*V.proporciones.barraVida,10+8*V.proporciones.barraVida,this.imagenes.barraVida.width*V.proporciones.barraVida*this.anchoVidaActual,this.imagenes.barraVida.height*V.proporciones.barraVida),this.anchoVidaActual>this.anchoVidaTarget?this.anchoVidaActual-=.05/this.vidaTotal:this.anchoVidaActual<this.anchoVidaTarget&&(this.anchoVidaActual+=.05/this.vidaTotal,this.anchoVidaTarget-this.anchoVidaActual<=.02)&&(this.anchoVidaActual=this.anchoVidaTarget)}dibujarPuntuacionPersonaje(){D.drawImage(this.imagenes.tilesetPuntuacion,0,0,this.imagenes.tilesetPuntuacion.width,this.imagenes.tilesetPuntuacion.height,10,10,this.imagenes.tilesetPuntuacion.width*V.proporciones.barraPuntuaciones,this.imagenes.tilesetPuntuacion.height*V.proporciones.barraPuntuaciones),D.font=16*V.proporciones.texto+"px VT323",D.fillStyle="white",D.fillText(""+this.puntuacion,10+this.imagenes.tilesetPuntuacion.width*V.proporciones.barraPuntuaciones-D.measureText(this.puntuacion).width-.046*this.imagenes.tilesetPuntuacion.width*V.proporciones.barraPuntuaciones,10+this.imagenes.tilesetPuntuacion.height*V.proporciones.barraPuntuaciones-.1*this.imagenes.tilesetPuntuacion.height*V.proporciones.barraPuntuaciones)}dibujarEnergiaPersonaje(){D.drawImage(this.imagenes.contenedorEnergia,0,0,this.imagenes.contenedorEnergia.width,this.imagenes.contenedorEnergia.height,10+25*V.proporciones.barraEnergia,10+12*V.proporciones.barraEnergia,this.imagenes.contenedorEnergia.width*V.proporciones.barraEnergia,this.imagenes.contenedorEnergia.height*V.proporciones.barraEnergia),this.anchoEnergiaTarget=this.energia/this.energiaTotal,D.drawImage(this.imagenes.barraEnergia,0,0,this.imagenes.barraEnergia.width,this.imagenes.barraEnergia.height,10+26*V.proporciones.barraEnergia,10+14*V.proporciones.barraEnergia,this.imagenes.barraEnergia.width*V.proporciones.barraEnergia*this.anchoEnergiaActual,this.imagenes.barraEnergia.height*V.proporciones.barraEnergia),this.anchoEnergiaActual>this.anchoEnergiaTarget?(this.anchoEnergiaActual-=.1/this.energiaTotal,this.anchoEnergiaActual=Math.round(1e3*this.anchoEnergiaActual)/1e3):this.anchoEnergiaActual<this.anchoEnergiaTarget&&this.tiempoEnergia>=this.tiempoRecuperarEnergia&&(.98<=this.anchoEnergiaActual?this.anchoEnergiaActual=1:(this.anchoEnergiaActual+=.05/this.energiaTotal,this.anchoEnergiaActual=Math.round(1e3*this.anchoEnergiaActual)/1e3)),this.recuperarEnergia()}recuperarEnergia(){V.controles[" "].presionada?(this.mapaEnergia.cuadroActual=0,this.tiempoEnergia=0):this.energia<4&&(this.mapaEnergia.cuadroActual++,this.tiempoEnergia>=this.tiempoRecuperarEnergia?this.energia++:this.tiempoEnergia+=V.deltaTiempo)}dibujar(){this.dibujarPersonaje(),this.dibujarVidaPersonaje(),this.dibujarPuntuacionPersonaje(),this.dibujarEnergiaPersonaje(),this.lanzarAtaques()}animarSprite(){this.contadorCuadros++,this.contadorLimiteCuadros=Math.ceil(this.mapa[this.estado].contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros),this.contadorCuadros%this.contadorLimiteCuadros==0&&(this.cuadroActual<this.mapa[this.estado].frames-1?(this.cuadroActual++,"daño"==this.estado&&this.cuadroActual+1>=this.mapa[this.estado].frames-1&&(this.recibiendoDaño=!1),"ataque"==this.estado&&this.cuadroActual+1>=this.mapa[this.estado].frames-1&&(this.realizandoAtaque=!1,this.lanzarAtaques()),"muerto"==this.estado&&this.cuadroActual+1>=this.mapa[this.estado].frames-1&&setTimeout(()=>{V.finalizar()},1e3),"caida"==this.estado&&this.cuadroActual+1>=this.mapa[this.estado].frames-1&&this.estado):"muerto"!=this.estado&&(this.cuadroActual=0,this.cicloAnimacion++))}detectarColisionPlataforma(){V.fondo.escenario.plataformas.forEach(o=>{this.posicion.y+this.height<=o.posicion.y&&this.posicion.y+this.height+this.velocidad.y>=o.posicion.y&&this.posicion.x+this.width>=o.posicion.x&&this.posicion.x<=o.posicion.x+o.width&&(this.velocidad.y=0)})}cambiarVelocidad(){V.controles.ArrowRight.presionada||V.controles.d.presionada?(this.ultimaDireccion="derecha",this.velocidad.x=5*V.proporcionesFPS.proporcionMovimiento):V.controles.ArrowLeft.presionada||V.controles.a.presionada?(this.ultimaDireccion="izquierda",this.velocidad.x=-5*V.proporcionesFPS.proporcionMovimiento):this.velocidad.x=0}"recibirDaño"(o){this.vida-=o,this.recibiendoDaño=!0,this.parpadeando=!0,this.parpadear=!0,this.invulnerable=!0,this.tiempoInvulnerableTranscurrido=0,this.tiempoParpadeoTranscurrido=0,"derecha"==this.ultimaDireccion?this.posicion.x-=80:this.posicion.x+=80,this.velocidad.y=-10}cambiarEstado(){this.vida<1?"muerto"!=this.estado&&(Object.keys(V.controles).forEach(o=>{V.controles[o].presionada=!1}),this.estado="muerto",this.cuadroActual=0):this.realizandoAtaque?"ataque"!=this.estado&&(this.estado="ataque",this.cuadroActual=0):V.controles.ArrowLeft.presionada||V.controles.a.presionada||V.controles.ArrowRight.presionada||V.controles.d.presionada?this.velocidad.y<0?"saltando"!=this.estado&&(this.estado="saltando",this.cuadroActual=0):this.velocidad.y>V.gravedad?"caida"!=this.estado&&(this.estado="caida",this.cuadroActual=0):"corriendo"!=this.estado&&(this.ultimaDireccion="derecha",this.estado="corriendo",this.cuadroActual=0):V.controles.ArrowUp.presionada||V.controles.w.presionada?!(this.velocidad.y<0)&&this.velocidad.y>V.gravedad?"caida"!=this.estado&&(this.estado="caida",this.cuadroActual=0):"saltando"!=this.estado&&(this.estado="saltando",this.cuadroActual=0):this.velocidad.y<0?"saltando"!=this.estado&&(this.estado="saltando",this.cuadroActual=0):this.velocidad.y>V.gravedad?"caida"!=this.estado&&(this.estado="caida",this.cuadroActual=0):"inactivo"!=this.estado&&(this.estado="inactivo",this.cuadroActual=0)}crearAtaque(){let o=0,i=0;i="derecha"==this.ultimaDireccion?(o=this.posicion.x+this.offset.x/2,7):(o=this.posicion.x-this.offset.x/2,-7),this.ataques.push(new p({posicion:{x:o,y:this.posicion.y},velocidad:{x:i,y:0},imagenes:{bolaFuego:this.imagenes.bolaFuego,impactoAtaque:this.imagenes.impactoAtaque},direccion:this.ultimaDireccion,offset:{x:35,y:50},"daño":20}))}lanzarAtaques(){this.ataques=this.ataques.filter(o=>!o.liberar),this.ataques.forEach((o,i)=>{o.liberar?this.ataques.splice(i,1):o.actualizarAtaque()})}actualizarSprite(){this.posicion.y+=this.velocidad.y,this.posicion.x+=this.velocidad.x,this.parpadeando&&(this.tiempoParpadeoTranscurrido>=this.tiempoParpadeoDaño?this.parpadeando=!1:this.tiempoParpadeoTranscurrido+=V.deltaTiempo),this.invulnerable&&(this.tiempoInvulnerableTranscurrido>=this.tiempoInvulnerabilidad?this.invulnerable=!1:this.tiempoInvulnerableTranscurrido+=V.deltaTiempo),this.dibujar(),this.animarSprite(),this.posicion.y-this.velocidad.y>q.height?(this.vida=0,this.velocidad.y=0):this.posicion.y+this.velocidad.y<q.height-this.height&&(this.velocidad.y+=V.gravedad),this.cambiarVelocidad(),this.cambiarEstado()}}class d extends o{constructor({posicion:o,velocidad:i,imagenes:a,plataformas:e}){super({posicion:o,velocidad:i,imagenes:a}),this.plataformas=e}generarNuevaPlataforma(){var i=this.plataformas[this.plataformas.length-1];if(i&&i.posicion.x<q.width){Math.round(Math.random());var a=q.height,e=i.imagenes.tilesetArbol_1.height*V.proporciones.plataforma.arbol_1+50,a=.9*a,a=Math.round(Math.random()*(a-e)+e);let o=Math.round(Math.random()*(.15*q.width-250)+250);300<o&&(o=300),this.plataformas.push(new l({posicion:{x:i.posicion.x+i.width+o,y:a},width:Math.floor(1001*Math.random())+200,imagenes:V.tilesetEscenario,offset:{x:16,y:28}}));e=this.plataformas[this.plataformas.length-1];this.generarElementosPlataforma(e),Math.random()<.8&&this.generarEnemigoPlataforma(e)}}generarEnemigoPlataforma(o){o.enemigoCreado||(o.agregarEnemigos(),o.enemigoCreado=!0)}generarElementosPlataforma(o){var i=Math.random();i<=.1?(o.tile.arbol.arbol_1.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbol_1.width*V.proporciones.plataforma.arbol_1))+o.posicion.x,o.tile.arbol.arbol_1.pintar=!0,o.tile.arbol.arbol_2.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbol_2.width*V.proporciones.plataforma.arbol_2))+o.posicion.x,o.tile.arbol.arbol_2.pintar=!0,o.tile.arbusto.arbusto_1.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbusto_1.width*V.proporciones.plataforma.arbusto_1))+o.posicion.x+o.offset.x,o.tile.arbusto.arbusto_1.pintar=!0,o.tile.arbusto.arbusto_2.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbusto_2.width*V.proporciones.plataforma.arbusto_2))+o.posicion.x+o.offset.x,o.tile.arbusto.arbusto_2.pintar=!0):.2<i&&i<.3?(o.tile.arbol.arbol_1.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbol_1.width*V.proporciones.plataforma.arbol_1))+o.posicion.x+o.offset.x,o.tile.arbol.arbol_1.pintar=!0,o.tile.arbol.arbol_2.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbol_2.width*V.proporciones.plataforma.arbol_2))+o.posicion.x+o.offset.x,o.tile.arbol.arbol_2.pintar=!0,o.tile.arbusto.arbusto_1.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbusto_1.width*V.proporciones.plataforma.arbusto_1))+o.posicion.x+o.offset.x,o.tile.arbusto.arbusto_1.pintar=!0):.3<i&&i<.5?(o.tile.arbol.arbol_1.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbol_1.width*V.proporciones.plataforma.arbol_1))+o.posicion.x+o.offset.x,o.tile.arbol.arbol_1.pintar=!0,o.tile.arbusto.arbusto_1.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbusto_1.width*V.proporciones.plataforma.arbusto_1))+o.posicion.x+o.offset.x,o.tile.arbusto.arbusto_1.pintar=!0):i<.7?(o.tile.arbol.arbol_2.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbol_2.width*V.proporciones.plataforma.arbol_2))+o.posicion.x+o.offset.x,o.tile.arbol.arbol_2.pintar=!0):.8<i&&i<.9&&(o.tile.arbusto.arbusto_2.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetArbusto_2.width*V.proporciones.plataforma.arbusto_2))+o.posicion.x+o.offset.x,o.tile.arbusto.arbusto_2.pintar=!0,o.tile.cascada.x=Math.round(Math.random()*(o.posicion.x+o.width-o.posicion.x-o.imagenes.tilesetCascada.cascada_1.width*V.proporciones.plataforma.cascada))+o.posicion.x+o.offset.x,o.tile.cascada.y=o.posicion.y+25,o.tile.cascada.y=o.posicion.y+25*V.proporcionResolucion,o.tile.cascada.pintar=!0)}pintarPrimerEscena(){var o=this.plataformas[0];o.tile.arbol.arbol_1.x=o.posicion.x+.2*o.width,o.tile.arbol.arbol_2.x=o.posicion.x+.8*o.width,o.tile.arbusto.arbusto_1.x=o.posicion.x+.05*o.width,o.tile.arbusto.arbusto_2.x=o.posicion.x+o.width-o.imagenes.tilesetArbusto_2.width*V.proporciones.plataforma.arbusto_2,o.tile.cascada.x=o.posicion.x+.09*o.width,o.tile.cascada.y=o.posicion.y+25,o.tile.cascada.y=o.posicion.y+25*V.proporcionResolucion,o.tile.arbol.arbol_1.pintar=!0,o.tile.arbol.arbol_2.pintar=!0,o.tile.arbusto.arbusto_1.pintar=!0,o.tile.arbusto.arbusto_2.pintar=!0,o.tile.cascada.pintar=!0}actualizarSprite(){this.generarNuevaPlataforma(),this.pintarPrimerEscena(),this.plataformas.forEach(o=>o.moverPlataforma()),this.plataformas.forEach(o=>{0<o.posicion.x+o.width&&this.posicion.x<q.width&&o.actualizarSprite()})}}class l extends o{constructor({posicion:o={x:0,y:0},velocidad:i={x:0,y:0},imagenes:a,width:e,offset:t}){super({posicion:o,velocidad:i,imagenes:a,offset:t}),this.width=e,this.height=32,this.anchoPixel=32,this.altoPixel=32,this.enemigoCreado=!1,this.enemigos=[],this.items=[],this.listaEnemigos=["jabali","samurai","caballeroOscuro"],this.tile={arbol:{arbol_1:{x:this.width,pintar:!1,offset:{x:0,y:0}},arbol_2:{x:this.width,pintar:!1,offset:{x:0,y:0}}},arbusto:{arbusto_1:{x:this.width,pintar:!1,offset:{x:0,y:8}},arbusto_2:{x:this.width,pintar:!1,offset:{x:0,y:8}}},cascada:{x:this.width,y:0,pintar:!1}},this.cascada={frameActual:this.imagenes.tilesetCascada.cascada_1,cascada_1:this.imagenes.tilesetCascada.cascada_1,cascada_2:this.imagenes.tilesetCascada.cascada_2,cascada_3:this.imagenes.tilesetCascada.cascada_3,cascada_4:this.imagenes.tilesetCascada.cascada_4,cascada_5:this.imagenes.tilesetCascada.cascada_5},this.contadorLimiteCuadros=36,this.contadorCuadros=0}dibujarElementosPlataforma(){this.contadorCuadros++,this.tile.arbol.arbol_1.pintar&&this.dibujarArbol1(),this.tile.arbol.arbol_2.pintar&&this.dibujarArbol2(),this.tile.arbusto.arbusto_1.pintar&&this.dibujarArbusto1(),this.tile.arbusto.arbusto_2.pintar&&this.dibujarArbusto2()}alternarFrame(){switch(this.cascada.frameActual){case this.cascada.cascada_1:this.cascada.frameActual=this.cascada.cascada_2;break;case this.cascada.cascada_2:this.cascada.frameActual=this.cascada.cascada_3;break;case this.cascada.cascada_3:this.cascada.frameActual=this.cascada.cascada_4;break;case this.cascada.cascada_4:this.cascada.frameActual=this.cascada.cascada_5;break;case this.cascada.cascada_5:this.cascada.frameActual=this.cascada.cascada_1}}dibujar(){this.dibujarElementosPlataforma(),this.dibujarPlataforma(),this.tile.cascada.pintar&&(this.dibujarCascada(),this.contadorCuadros%(this.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0)&&this.alternarFrame(),this.dibujarEnemigosPlataforma(),this.dibujarItemsPlataforma()}dibujarItemsPlataforma(){this.items=this.items.filter(o=>!o.liberar),this.items.forEach(o=>{o instanceof s&&o.actualizarSprite()})}agregarEnemigos(){var o;parseInt(V.personaje.puntuacion)<1e3?this.enemigos.push(this.crearEnemigoJabali()):parseInt(V.personaje.puntuacion)<2e3?Math.random()<.2?(this.enemigos.push(this.crearEnemigoJabali()),this.enemigos.push(this.crearEnemigoSamurai())):0==Math.round(Math.random()*this.listaEnemigos.length)?this.enemigos.push(this.crearEnemigoJabali()):this.enemigos.push(this.crearEnemigoSamurai()):parseInt(V.personaje.puntuacion)<3e3?(o=Math.random())<.1?(this.enemigos.push(this.crearEnemigoCaballeroOscuro()),this.enemigos.push(this.crearEnemigoSamurai())):o<.2?(this.enemigos.push(this.crearEnemigoJabali()),this.enemigos.push(this.crearEnemigoSamurai())):0==(o=Math.round(Math.random()*this.listaEnemigos.length))?this.enemigos.push(this.crearEnemigoJabali()):1==o?this.enemigos.push(this.crearEnemigoSamurai()):this.enemigos.push(this.crearEnemigoCaballeroOscuro()):((o=Math.random())<.1?(this.enemigos.push(this.crearEnemigoCaballeroOscuro()),this.enemigos.push(this.crearEnemigoSamurai())):o<.2&&(this.enemigos.push(this.crearEnemigoJabali()),this.enemigos.push(this.crearEnemigoSamurai())),o<.5?0==(o=Math.round(Math.random()*this.listaEnemigos.length))?this.enemigos.push(this.crearEnemigoJabali()):1==o?this.enemigos.push(this.crearEnemigoSamurai()):this.enemigos.push(this.crearEnemigoCaballeroOscuro()):this.enemigos.push(this.crearEnemigoMinotauro()))}crearEnemigoMinotauro(){var o={pocion:!1};return Math.random()<.2&&(o.pocion=!0),new r({posicion:{x:this.posicion.x+this.offset.x+(.4*this.width*Math.random()-2*V.proporciones.enemigos.minotauro.alcanceVigilar-V.imagenesEnemigos.minotauro.width/8*V.proporciones.enemigos.minotauro.proporcion)+3*V.proporciones.enemigos.minotauro.alcanceVigilar+V.imagenesEnemigos.minotauro.width/8*V.proporciones.enemigos.minotauro.proporcion,y:this.posicion.y-V.imagenesEnemigos.minotauro.height/10*V.proporciones.enemigos.minotauro.proporcion},velocidad:{x:0,y:0},imagenes:{enemigo:V.imagenesEnemigos.minotauro,muerte:V.imagenesEnemigos.muerte},offset:{x:72*V.proporciones.enemigos.minotauro.proporcion,y:54*V.proporciones.enemigos.minotauro.proporcion},puntaje:500,proporcion:"minotauro",vida:300,defensa:10,armadura:100,plataforma:this,drop:o})}crearEnemigoCaballeroOscuro(){var o={pocion:!1};return Math.random()<.2&&(o.pocion=!0),new n({posicion:{x:this.posicion.x+this.offset.x+(.4*this.width*Math.random()-2*V.proporciones.enemigos.caballeroOscuro.alcanceVigilar-V.imagenesEnemigos.caballeroOscuro.width/8*V.proporciones.enemigos.caballeroOscuro.proporcion)+3*V.proporciones.enemigos.caballeroOscuro.alcanceVigilar+V.imagenesEnemigos.caballeroOscuro.width/8*V.proporciones.enemigos.caballeroOscuro.proporcion,y:this.posicion.y-V.imagenesEnemigos.caballeroOscuro.height/3*V.proporciones.enemigos.caballeroOscuro.proporcion},velocidad:{x:0,y:0},imagenes:{enemigo:V.imagenesEnemigos.caballeroOscuro,muerte:V.imagenesEnemigos.muerte},offset:{x:48*V.proporciones.enemigos.caballeroOscuro.proporcion,y:20*V.proporciones.enemigos.caballeroOscuro.proporcion},puntaje:300,proporcion:"caballeroOscuro",vida:50,defensa:10,armadura:300,plataforma:this,drop:o})}crearEnemigoSamurai(){var o={pocion:!1};return Math.random()<.2&&(o.pocion=!0),new h({posicion:{x:this.posicion.x+this.offset.x+(.4*this.width*Math.random()-2*V.proporciones.enemigos.samurai.alcanceVigilar-V.imagenesEnemigos.samurai.width/8*V.proporciones.enemigos.samurai.proporcion)+3*V.proporciones.enemigos.samurai.alcanceVigilar+V.imagenesEnemigos.samurai.width/8*V.proporciones.enemigos.samurai.proporcion,y:this.posicion.y-V.imagenesEnemigos.samurai.height/3*V.proporciones.enemigos.samurai.proporcion},velocidad:{x:0,y:0},imagenes:{enemigo:V.imagenesEnemigos.samurai,muerte:V.imagenesEnemigos.muerte},offset:{x:48*V.proporciones.enemigos.samurai.proporcion,y:20*V.proporciones.enemigos.samurai.proporcion},puntaje:200,proporcion:"samurai",vida:100,defensa:5,armadura:50,plataforma:this,drop:o})}crearEnemigoJabali(){var o={pocion:!1};return Math.random()<.2&&(o.pocion=!0),new c({posicion:{x:this.posicion.x+this.offset.x+(.4*this.width*Math.random()-2*V.proporciones.enemigos.jabali.alcanceVigilar-V.imagenesEnemigos.jabali.width/8*V.proporciones.enemigos.jabali.proporcion)+3*V.proporciones.enemigos.jabali.alcanceVigilar+V.imagenesEnemigos.jabali.width/8*V.proporciones.enemigos.jabali.proporcion,y:this.posicion.y-V.imagenesEnemigos.jabali.height/3*V.proporciones.enemigos.jabali.proporcion},velocidad:{x:0,y:0},imagenes:{enemigo:V.imagenesEnemigos.jabali,muerte:V.imagenesEnemigos.muerte},offset:{x:48*V.proporciones.enemigos.jabali.proporcion,y:20*V.proporciones.enemigos.jabali.proporcion},puntaje:100,proporcion:"jabali",vida:50,defensa:2,armadura:20,plataforma:this,drop:o})}dibujarEnemigosPlataforma(){this.enemigos=this.enemigos.filter(o=>!o.liberar),0<this.enemigos.length&&this.enemigos.forEach(o=>o.actualizar())}dibujarCascada(){D.drawImage(this.cascada.frameActual,0,0,this.cascada.frameActual.width,this.cascada.frameActual.height,this.tile.cascada.x,this.tile.cascada.y,this.cascada.frameActual.width*V.proporciones.plataforma.cascada,this.cascada.frameActual.height*V.proporciones.plataforma.cascada)}dibujarArbol1(){D.drawImage(this.imagenes.tilesetArbol_1,0,0,this.imagenes.tilesetArbol_1.width,this.imagenes.tilesetArbol_1.height,this.tile.arbol.arbol_1.x,this.posicion.y-this.imagenes.tilesetArbol_1.height*V.proporciones.plataforma.arbol_1,this.imagenes.tilesetArbol_1.width*V.proporciones.plataforma.arbol_1,this.imagenes.tilesetArbol_1.height*V.proporciones.plataforma.arbol_1)}dibujarArbol2(){D.drawImage(this.imagenes.tilesetArbol_2,0,0,this.imagenes.tilesetArbol_2.width,this.imagenes.tilesetArbol_2.height,this.tile.arbol.arbol_2.x,this.posicion.y-this.imagenes.tilesetArbol_2.height*V.proporciones.plataforma.arbol_2,this.imagenes.tilesetArbol_2.width*V.proporciones.plataforma.arbol_2,this.imagenes.tilesetArbol_2.height*V.proporciones.plataforma.arbol_2)}dibujarArbusto1(){D.drawImage(this.imagenes.tilesetArbusto_1,0,0,this.imagenes.tilesetArbusto_1.width,this.imagenes.tilesetArbusto_1.height,this.tile.arbusto.arbusto_1.x,this.posicion.y-this.imagenes.tilesetArbusto_1.height*V.proporciones.plataforma.arbusto_1+this.tile.arbusto.arbusto_1.offset.y,this.imagenes.tilesetArbusto_1.width*V.proporciones.plataforma.arbusto_1,this.imagenes.tilesetArbusto_1.height*V.proporciones.plataforma.arbusto_1)}dibujarArbusto2(){D.drawImage(this.imagenes.tilesetArbusto_2,0,0,this.imagenes.tilesetArbusto_2.width,this.imagenes.tilesetArbusto_2.height,this.tile.arbusto.arbusto_2.x,this.posicion.y-this.imagenes.tilesetArbusto_2.height*V.proporciones.plataforma.arbusto_2+this.tile.arbusto.arbusto_2.offset.y,this.imagenes.tilesetArbusto_2.width*V.proporciones.plataforma.arbusto_2,this.imagenes.tilesetArbusto_2.height*V.proporciones.plataforma.arbusto_2)}dibujarPlataforma(){var o=Math.ceil(this.width/(this.anchoPixel*V.proporciones.plataforma.suelo)),i=Math.ceil((q.height-this.posicion.y)/(this.altoPixel*V.proporciones.plataforma.suelo))+1,a=[[this.imagenes.tilesetSuelo.suelo_0_0,this.imagenes.tilesetSuelo.suelo_0_1,this.imagenes.tilesetSuelo.suelo_0_2,this.imagenes.tilesetSuelo.suelo_0_3,this.imagenes.tilesetSuelo.suelo_0_4],[this.imagenes.tilesetSuelo.suelo_1_0,this.imagenes.tilesetSuelo.suelo_1_1,this.imagenes.tilesetSuelo.suelo_1_2,this.imagenes.tilesetSuelo.suelo_1_3,this.imagenes.tilesetSuelo.suelo_1_4],[this.imagenes.tilesetSuelo.suelo_2_0,this.imagenes.tilesetSuelo.suelo_2_1,this.imagenes.tilesetSuelo.suelo_2_2,this.imagenes.tilesetSuelo.suelo_2_3,this.imagenes.tilesetSuelo.suelo_2_4],[this.imagenes.tilesetSuelo.suelo_3_0,this.imagenes.tilesetSuelo.suelo_3_1,this.imagenes.tilesetSuelo.suelo_3_2,this.imagenes.tilesetSuelo.suelo_3_3,this.imagenes.tilesetSuelo.suelo_3_4]];let e=a.length,t=a[0].length;if(o>a[0].length){var s=Math.ceil((o-a[0].length)/3);for(let i=0;i<e;i++)for(let o=0;o<s;o++)a[i].splice(-1,0,a[i][1]),a[i].splice(-1,0,a[i][2]),a[i].splice(-1,0,a[i][3]);t=a[0].length}if(a.length<i){var r=i-a.length;for(let o=0;o<r;o++)a.splice(-1,0,a[a.length-2]);e=a.length}for(let i=0;i<e;i++)for(let o=0;o<t;o++)D.drawImage(a[i][o],0,0,+this.anchoPixel,this.altoPixel,this.posicion.x+this.anchoPixel*o*V.proporciones.plataforma.suelo,this.posicion.y+this.anchoPixel*i*V.proporciones.plataforma.suelo-this.offset.y*V.proporciones.plataforma.suelo,this.anchoPixel*V.proporciones.plataforma.suelo,this.altoPixel*V.proporciones.plataforma.suelo);o=a[0].reduce((o,i)=>o+i.width*V.proporciones.plataforma.suelo,0);this.width<o&&(this.width=o-this.offset.x-16)}moverPlataforma(){(V.controles.ArrowRight.presionada||V.controles.d.presionada)&&V.personaje.posicion.x>.6*q.width||(V.controles.ArrowLeft.presionada||V.controles.a.presionada)&&V.personaje.posicion.x<.4*q.width?(V.personaje.ataques.forEach(o=>{0<o.velocidad.x?V.controles.ArrowRight.presionada?o.velocidad.x=5*V.proporcionesFPS.proporcionMovimiento-2*V.proporcionesFPS.proporcionMovimiento:V.controles.ArrowLeft.presionada&&(o.velocidad.x=5*V.proporcionesFPS.proporcionMovimiento+2*V.proporcionesFPS.proporcionMovimiento):V.controles.ArrowRight.presionada?o.velocidad.x=-5*V.proporcionesFPS.proporcionMovimiento-2*V.proporcionesFPS.proporcionMovimiento:V.controles.ArrowRight.presionada&&(o.velocidad.x=-5*V.proporcionesFPS.proporcionMovimiento+2*V.proporcionesFPS.proporcionMovimiento)}),V.personaje.velocidad.x=0,(V.controles.ArrowRight.presionada||V.controles.d.presionada)&&(this.enemigos.forEach(o=>{o.posicion.x+=-Math.round(5*V.proporcionesFPS.proporcionMovimiento),o.posicionInicial+=-Math.round(5*V.proporcionesFPS.proporcionMovimiento)}),this.items.forEach(o=>{o.posicion.x+=-Math.round(5*V.proporcionesFPS.proporcionMovimiento)}),this.posicion.x+=-Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbol.arbol_1.x-=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbol.arbol_2.x-=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbusto.arbusto_1.x-=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbusto.arbusto_2.x-=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.cascada.x-=Math.round(5*V.proporcionesFPS.proporcionMovimiento)),(V.controles.ArrowLeft.presionada||V.controles.a.presionada)&&(this.enemigos.forEach(o=>{o.posicion.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento),o.posicionInicial+=Math.round(5*V.proporcionesFPS.proporcionMovimiento)}),this.items.forEach(o=>{o.posicion.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento)}),this.posicion.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbol.arbol_1.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbol.arbol_2.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbusto.arbusto_1.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.arbusto.arbusto_2.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento),this.tile.cascada.x+=Math.round(5*V.proporcionesFPS.proporcionMovimiento))):V.personaje.ataques.forEach(o=>{0<o.velocidad.x?o.velocidad.x=5*V.proporcionesFPS.proporcionMovimiento+2*V.proporcionesFPS.proporcionMovimiento:o.velocidad.x=-5*V.proporcionesFPS.proporcionMovimiento-2*V.proporcionesFPS.proporcionMovimiento})}detectarColisionPersonaje(){V.personaje.posicion.y+V.personaje.height<=this.posicion.y&&V.personaje.posicion.y+V.personaje.height+V.personaje.velocidad.y>=this.posicion.y&&V.personaje.posicion.x+V.personaje.width-V.personaje.offset.x>=this.posicion.x&&V.personaje.posicion.x<=this.posicion.x+this.width-this.offset.x*V.proporciones.plataforma.suelo&&(V.personaje.velocidad.y=0,V.personaje.saltando=!1,V.personaje.dobleSalto=!1)}detectarColisionEnemigo(){V.personaje.invulnerable||this.enemigos.forEach(o=>{V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision>o.posicion.x+o.offset.x/2&&V.personaje.posicion.x+V.personaje.offset.x/2<o.posicion.x+o.offset.x/2+o.anchoColision&&V.personaje.posicion.y+V.personaje.height>o.posicion.y+o.offset.y&&V.personaje.posicion.y<o.posicion.y+o.offset.y+o.altoColision&&0<o.vida&&V.personaje.recibirDaño(o.dañoAtaque)})}detectarColisionItem(){this.items.forEach(o=>{V.personaje.posicion.x+V.personaje.offset.x/2+V.personaje.anchoColision>o.posicion.x+o.offset.x/2&&V.personaje.posicion.x+V.personaje.offset.x/2<o.posicion.x+o.offset.x/2+o.anchoColision&&V.personaje.posicion.y+V.personaje.height>o.posicion.y+o.offset.y&&V.personaje.posicion.y<o.posicion.y+o.offset.y+o.altoColision&&o instanceof s&&V.personaje.vida<4&&(o.consumir=!0,o.consumido||(o.consumido=!0,V.personaje.vida+=1))})}actualizarSprite(){this.detectarColisionPersonaje(),this.detectarColisionEnemigo(),this.detectarColisionItem(),this.dibujar()}}class u extends o{constructor({posicion:o,velocidad:i,imagenes:a,contadorLimiteCuadros:e,escenario:t}){super({posicion:o,velocidad:i,imagenes:a}),this.PLANOS={principal:.8,medio:.2,fondo:.09,"sin-definir":0},this.escenario=t,this.imagenes.montaña_1.frameActual=this.imagenes.montaña_1.frame_1,this.imagenes.montaña_1.posicion.x=0,this.imagenes.montaña_1.posicion.y=q.height-this.imagenes.montaña_1.frameActual.height*V.proporciones.fondo.montaña_1,this.imagenes.montaña_2.frameActual=this.imagenes.montaña_2.frame_1,this.imagenes.montaña_2.posicion.x=q.width,this.imagenes.montaña_2.posicion.y=q.height-this.imagenes.montaña_2.frameActual.height*V.proporciones.fondo.montaña_2,this.imagenes.montaña_3.frameActual=this.imagenes.montaña_3.frame_1,this.imagenes.montaña_3.posicion.x=this.imagenes.montaña_3.frameActual.width/4,this.imagenes.montaña_3.posicion.y=q.height-this.imagenes.montaña_3.frameActual.height*V.proporciones.fondo.montaña_3+this.imagenes.montaña_3.offset.y,this.imagenes.montaña_4.frameActual=this.imagenes.montaña_4.frame_1,this.imagenes.montaña_4.posicion.x=q.width,this.imagenes.montaña_4.posicion.y=q.height-this.imagenes.montaña_4.frameActual.height*V.proporciones.fondo.montaña_4+this.imagenes.montaña_4.offset.y,this.imagenes.montaña_5.frameActual=this.imagenes.montaña_5.frame_1,this.imagenes.montaña_5.posicion.x=this.imagenes.montaña_5.frameActual.width*V.proporciones.fondo.montaña_5/(200*V.proporciones.fondo.montaña_5),this.imagenes.montaña_5.posicion.y=q.height-this.imagenes.montaña_5.frameActual.height*V.proporciones.fondo.montaña_5+this.imagenes.montaña_5.offset.y,this.imagenes.nube_1.frameActual=this.imagenes.nube_1.frame_1,this.imagenes.nube_1.posicion.x=this.imagenes.nube_1.frameActual.width,this.imagenes.nube_1.posicion.y=this.imagenes.montaña_4.posicion.y+300,this.imagenes.nube_2.frameActual=this.imagenes.nube_2.frame_1,this.imagenes.nube_2.posicion.x=0,this.imagenes.nube_2.posicion.y=q.height-this.imagenes.nube_2.frameActual.height*V.proporciones.fondo.nube_2,this.imagenes.nube_3.frameActual=this.imagenes.nube_3.frame_1,this.imagenes.nube_3.posicion.y=q.height-this.imagenes.nube_3.frameActual.height*V.proporciones.fondo.nube_3+this.imagenes.nube_3.offset.y,this.contadorLimiteCuadros=e,this.contadorCuadros=0}dibujar(){D.drawImage(this.imagenes.fondo,0,0,this.imagenes.fondo.width,this.imagenes.fondo.height,0,0,q.width,q.height),D.drawImage(this.imagenes.montaña_1.frameActual,0,0,this.imagenes.montaña_1.ancho,this.imagenes.montaña_1.frameActual.height,this.imagenes.montaña_1.posicion.x,this.imagenes.montaña_1.posicion.y,this.imagenes.montaña_1.ancho*V.proporciones.fondo.montaña_1,this.imagenes.montaña_1.frameActual.height*V.proporciones.fondo.montaña_1),D.drawImage(this.imagenes.montaña_2.frameActual,0,0,this.imagenes.montaña_2.ancho,this.imagenes.montaña_2.frameActual.height,this.imagenes.montaña_2.posicion.x,this.imagenes.montaña_2.posicion.y,this.imagenes.montaña_2.ancho*V.proporciones.fondo.montaña_2,this.imagenes.montaña_2.frameActual.height*V.proporciones.fondo.montaña_2),D.drawImage(this.imagenes.montaña_3.frameActual,this.imagenes.montaña_3.ancho,0,this.imagenes.montaña_3.frameActual.width,this.imagenes.montaña_3.frameActual.height,this.imagenes.montaña_3.posicion.x,this.imagenes.montaña_3.posicion.y,this.imagenes.montaña_3.frameActual.width*V.proporciones.fondo.montaña_3,this.imagenes.montaña_3.frameActual.height*V.proporciones.fondo.montaña_3),D.drawImage(this.imagenes.montaña_4.frameActual,this.imagenes.montaña_4.ancho,0,this.imagenes.montaña_4.frameActual.width,this.imagenes.montaña_4.frameActual.height,this.imagenes.montaña_4.posicion.x,this.imagenes.montaña_4.posicion.y,this.imagenes.montaña_4.frameActual.width*V.proporciones.fondo.montaña_4,this.imagenes.montaña_4.frameActual.height*V.proporciones.fondo.montaña_4),D.drawImage(this.imagenes.nube_1.frameActual,0,0,this.imagenes.nube_1.frameActual.width,this.imagenes.nube_1.frameActual.height,this.imagenes.nube_1.posicion.x,this.imagenes.nube_1.posicion.y,this.imagenes.nube_1.frameActual.width*V.proporciones.fondo.nube_1,this.imagenes.nube_1.frameActual.height*V.proporciones.fondo.nube_1),D.drawImage(this.imagenes.montaña_5.frameActual,0,0,this.imagenes.montaña_5.frameActual.width,this.imagenes.montaña_5.frameActual.height,this.imagenes.montaña_5.posicion.x,this.imagenes.montaña_5.posicion.y,this.imagenes.montaña_5.frameActual.width*V.proporciones.fondo.montaña_5,this.imagenes.montaña_5.frameActual.height*V.proporciones.fondo.montaña_5),this.escenario.actualizarSprite()}dibujarNube3(){D.drawImage(this.imagenes.nube_3.frameActual,0,0,this.imagenes.nube_2.frameActual.width,this.imagenes.nube_3.frameActual.height,this.imagenes.nube_3.posicion.x,this.imagenes.nube_3.posicion.y,this.imagenes.nube_3.frameActual.width*V.proporciones.fondo.nube_3,this.imagenes.nube_3.frameActual.height*V.proporciones.fondo.nube_3)}alternarFrame(o){o.frameActual&&o.frame_1&&o.frame_2&&(o.frameActual===o.frame_1?o.frameActual=o.frame_2:o.frameActual=o.frame_1)}moverFondo(o){o.frameActual&&o.frame_1&&o.frame_2&&(o.posicion.x+o.frameActual.width*V.proporciones.fondo[o.proporcion]<0&&(o.posicion.x=q.width),o.posicion.x+=o.velocidad.x,o===this.imagenes.nube_3||o===this.imagenes.nube_1?o.velocidad.x=-this.PLANOS[o.plano]:(V.controles.ArrowRight.presionada||V.controles.d.presionada)&&V.personaje.posicion.x>.6*q.width||(V.controles.ArrowLeft.presionada||V.controles.a.presionada)&&V.personaje.posicion.x<200?!V.controles.ArrowRight.presionada&&!V.controles.d.presionada||V.controles.ArrowLeft.presionada||V.controles.a.presionada?!V.controles.ArrowLeft.presionada&&!V.controles.a.presionada||V.controles.ArrowRight.presionada||V.controles.d.presionada?o.velocidad.x=0:o.velocidad.x=this.PLANOS[o.plano]:o.velocidad.x=-this.PLANOS[o.plano]:o.velocidad.x=0)}actualizarSprite(){if(this.contadorCuadros++,this.contadorCuadros%(this.contadorLimiteCuadros/V.proporcionesFPS.proporcionLimiteCuadros)==0)for(const o in this.imagenes)this.alternarFrame(this.imagenes[o]);for(const i in this.imagenes)this.moverFondo(this.imagenes[i]);this.dibujar()}}document.querySelector(".container-principal");const g=document.querySelector(".principal");let b=document.getElementById("titulo"),f=b.dataset.titulo.split("");var _=document.querySelector(".panel-jugador");const x=document.getElementById("boton-jugar"),y=document.getElementById("boton-puntuaciones"),A=document.querySelector(".secundario"),v=document.querySelector(".container__alertas");var L=document.querySelector(".formulario-datos-jugador");const w=document.getElementById("nombre-jugador"),C=document.getElementById("iniciar-juego");var E=document.querySelector(".boton-volver-jugar"),T=document.querySelector(".boton-volver-puntuaciones");const j=document.querySelector(".terciario"),S=document.querySelector(".lista__puntuaciones"),I=document.querySelector(".loader");function P(){I.classList.remove("ocultar"),a().then(o=>{o&&(I.classList.add("ocultar"),g.classList.add("ocultar"),A.classList.add("ocultar"),j.classList.remove("ocultar"),j.classList.remove("animacion-desaparecer"),j.classList.add("animacion-aparecer"))}).catch(o=>{console.log(o),I.classList.add("ocultar"),g.classList.add("ocultar"),A.classList.add("ocultar"),j.classList.remove("ocultar"),j.classList.remove("animacion-desaparecer"),j.classList.add("animacion-aparecer"),g.removeEventListener("animationend",cbOcultarPanelPrincipal)})}function M(o,i=.5){let a=0;for(;F(a,i)<o&&F(a+i,i)<=o;)a+=i;if(o!=F(a))for(;F(a)<=o&&F(a+.001)<=o;)a+=.001;return a}function F(o,i=.5){let a=0;for(;0<o;)a+=o,o-=i;return a}window.addEventListener("load",function(o){x.focus()}),document.addEventListener("keydown",o=>{"ArrowUp"!=o.key&&"ArrowDown"!=o.key||(x==document.activeElement?y.focus():y==document.activeElement&&x.focus())}),f.forEach((o,i,a)=>{b.innerHTML+=" "!=o?`<span style="--i:${.2*i}s" class="texto-animado">${o}</span>`:`<span>${o}</span>`}),b.addEventListener("animationend",o=>{o.target.classList.remove("texto-animado"),setTimeout(()=>{o.target.classList.add("texto-animado")},.2*f.length-.2)}),_.addEventListener("submit",o=>{o.preventDefault()}),L.addEventListener("submit",o=>{o.preventDefault()}),x.addEventListener("click",()=>{g.classList.remove("animacion-aparecer"),g.classList.add("animacion-desaparecer"),g.addEventListener("animationend",function o(i){"desaparecer-texto"===i.animationName&&(g.classList.add("ocultar"),j.classList.add("ocultar"),A.classList.remove("ocultar"),A.classList.remove("animacion-desaparecer"),A.classList.add("animacion-aparecer"),g.removeEventListener("animationend",o))})}),C.addEventListener("click",a=>{if(A.addEventListener("animationend",function o(i){"desaparecer-texto"===i.animationName&&(A.classList.add("ocultar"),a.target==C&&(V.gameStart=!0,V.reproducirMusicaFondo()),A.removeEventListener("animationend",o))}),""==w.value.split()){var[{mensaje:o="CAMPO NOMBRE DE JUGADOR <b>REQUERIDO<b>",tipo:i="error"}]=[{}];const e=document.createElement("div");e.classList.add("alerta"),"error"==i?e.classList.add("alerta--error"):e.classList.add("alerta--info"),(i=document.createElement("p")).innerHTML=o,e.append(i),v.append(e),e.addEventListener("animationend",o=>{"desaparecer-alerta"==o.animationName&&v.removeChild(e)})}else A.classList.remove("animacion-aparecer"),A.classList.add("animacion-desaparecer")}),E.addEventListener("click",o=>{A.addEventListener("animationend",function o(i){"desaparecer-texto"===i.animationName&&(A.classList.add("ocultar"),j.classList.add("ocultar"),g.classList.remove("ocultar"),g.classList.remove("animacion-desaparecer"),g.classList.add("animacion-aparecer"),A.removeEventListener("animationend",o))}),A.classList.remove("animacion-aparecer"),A.classList.add("animacion-desaparecer")}),y.addEventListener("click",o=>{g.addEventListener("animationend",function i(o){"desaparecer-texto"===o.animationName&&(I.classList.remove("ocultar"),a().then(o=>{o&&(I.classList.add("ocultar"),g.classList.add("ocultar"),A.classList.add("ocultar"),j.classList.remove("ocultar"),j.classList.remove("animacion-desaparecer"),j.classList.add("animacion-aparecer"),g.removeEventListener("animationend",i))}).catch(o=>{console.log(o),I.classList.add("ocultar"),g.classList.add("ocultar"),A.classList.add("ocultar"),j.classList.remove("ocultar"),j.classList.remove("animacion-desaparecer"),j.classList.add("animacion-aparecer"),g.removeEventListener("animationend",i)}))}),g.classList.remove("animacion-aparecer"),g.classList.add("animacion-desaparecer")}),T.addEventListener("click",o=>{j.addEventListener("animationend",function o(i){"desaparecer-texto"===i.animationName&&(j.classList.add("ocultar"),g.classList.remove("ocultar"),g.classList.remove("animacion-desaparecer"),g.classList.add("animacion-aparecer"),j.removeEventListener("animationend",o))}),j.classList.remove("animacion-aparecer"),j.classList.add("animacion-desaparecer")});const q=document.getElementById("canvas"),D=q.getContext("2d"),V=(q.width=innerWidth,q.height=innerHeight,new class{constructor(){this.gameStart=!1,this.gameOver=!1,this.idAnimation=null,this.fps=0,this.establecerFPS=!1,this.contadorSeg=0,this.proporcionResolucion=Math.round(100*Math.min(q.width/1920,q.height/1333))/100,this.proporcionesFPS={proporcionLimiteCuadros:Math.round(1e3/this.fps*1/(1e3/165)),proporcionMovimiento:Math.round(1e3/this.fps*1/(1e3/165)),proporcionMovimientoEnemigo:Math.round(1e3/this.fps*1/(1e3/165)),proporcionSalto:Math.round(1e3/this.fps*1/(1e3/165))},this.proporcionesFPS.proporcionMovimiento=q.width*this.proporcionesFPS.proporcionMovimiento/2560,this._gravedad=1,this.saltoPersonaje=M(q.height*F(M(410,this.gravedad))/1333),this.ultimoTiempo=1,this.contadorTiempoFps=0,this.contadorFps=0,this.deltaTiempo=0,this._controles={ArrowUp:{presionada:!1},w:{presionada:!1},ArrowDown:{presionada:!1},ArrowLeft:{presionada:!1},a:{presionada:!1},ArrowRight:{presionada:!1},d:{presionada:!1}," ":{presionada:!1}},this.proporciones={ayuda:{libro:Math.ceil(2*this.proporcionResolucion),botonCerrar:Math.ceil(+this.proporcionResolucion),check:Math.ceil(2*this.proporcionResolucion),teclas:Math.ceil(2*this.proporcionResolucion),cerrar:Math.ceil(+this.proporcionResolucion)},pocion:Math.ceil(2*this.proporcionResolucion),texto:Math.ceil(2*this.proporcionResolucion),personaje:Math.ceil(4*this.proporcionResolucion),barraVida:Math.ceil(3*this.proporcionResolucion),barraEnergia:Math.ceil(3*this.proporcionResolucion),barraPuntuaciones:Math.ceil(3*this.proporcionResolucion),escenario:Math.ceil(3*this.proporcionResolucion),bolaFuego:Math.ceil(2*this.proporcionResolucion),impacto:Math.ceil(4*this.proporcionResolucion),enemigos:{samurai:{proporcion:Math.ceil(4*this.proporcionResolucion),alcanceVigilar:Math.ceil(100*this.proporcionResolucion)},jabali:{proporcion:Math.ceil(4*this.proporcionResolucion),alcanceVigilar:Math.ceil(100*this.proporcionResolucion)},caballeroOscuro:{proporcion:Math.ceil(4*this.proporcionResolucion),alcanceVigilar:Math.ceil(100*this.proporcionResolucion)},minotauro:{proporcion:Math.ceil(4*this.proporcionResolucion),alcanceVigilar:Math.ceil(100*this.proporcionResolucion)},humo:Math.ceil(4*this.proporcionResolucion)},fondo:{"montaña_1":Math.ceil(3*this.proporcionResolucion),"montaña_2":Math.ceil(2.5*this.proporcionResolucion),"montaña_3":Math.ceil(3*this.proporcionResolucion),"montaña_4":Math.ceil(3.5*this.proporcionResolucion),"montaña_5":Math.ceil(4.1*this.proporcionResolucion),nube_1:Math.ceil(2*this.proporcionResolucion),nube_2:Math.ceil(1.5*this.proporcionResolucion),nube_3:Math.ceil(3*this.proporcionResolucion)},plataforma:{suelo:Math.ceil(3*this.proporcionResolucion),arbol_1:Math.ceil(3*this.proporcionResolucion),arbol_2:Math.ceil(3*this.proporcionResolucion),arbusto_1:Math.ceil(3*this.proporcionResolucion),arbusto_2:Math.ceil(3*this.proporcionResolucion),cascada:Math.ceil(+this.proporcionResolucion)}},this.imagenesAyuda={abrirLibro:{frame_1:new Image,frame_2:new Image,frame_3:new Image,frame_4:new Image,frame_5:new Image,frame_6:new Image,frame_7:new Image,frame_8:new Image},cerrarLibro:{frame_1:new Image,frame_2:new Image,frame_3:new Image,frame_4:new Image,frame_5:new Image,frame_6:new Image,frame_7:new Image,frame_8:new Image},botonArriba:{frame_1:new Image,frame_2:new Image},botonDerecha:{frame_1:new Image,frame_2:new Image},botonIzquierda:{frame_1:new Image,frame_2:new Image},botonW:{frame_1:new Image,frame_2:new Image},botonA:{frame_1:new Image,frame_2:new Image},botonD:{frame_1:new Image,frame_2:new Image},botonEspacio:{frame_1:new Image,frame_2:new Image},botonCerrar:new Image,botonCheck:new Image,botonUncheck:new Image},this.imagenesFondo={fondo:new Image,"montaña_1":{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,ancho:210,plano:"fondo",posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"montaña_1"},"montaña_2":{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,plano:"fondo",ancho:369,posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"montaña_2"},"montaña_3":{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,ancho:450,plano:"medio",posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"montaña_3"},"montaña_4":{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,ancho:450,ancho:450,plano:"medio",posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"montaña_4"},"montaña_5":{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,ancho:450,plano:"principal",posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"montaña_5"},nube_1:{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,plano:"medio",posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"nube_1"},nube_2:{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,plano:"fondo",posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"nube_2"},nube_3:{frame_1:new Image,frame_2:new Image,frameActual:this.frame_1,plano:"principal",posicion:{x:0,y:0},velocidad:{x:0,y:0},offset:{x:0,y:0},proporcion:"nube_3"}},this.imagenesEnemigos={samurai:new Image,muerte:new Image,jabali:new Image,caballeroOscuro:new Image,minotauro:new Image,pocion:new Image},this.tilesetJugador={tileset:new Image,contenedorVida:new Image,contenedorEnergia:new Image,barraVida:new Image,barraEnergia:new Image,tilesetVida:new Image,tilesetEnergia:new Image,tilesetPuntuacion:new Image,bolaFuego:new Image,impactoAtaque:new Image},this.tilesetEscenario={tileset:new Image,tilesetSuelo:{suelo_0_0:new Image,suelo_0_1:new Image,suelo_0_2:new Image,suelo_0_3:new Image,suelo_0_4:new Image,suelo_1_0:new Image,suelo_1_1:new Image,suelo_1_2:new Image,suelo_1_3:new Image,suelo_1_4:new Image,suelo_2_0:new Image,suelo_2_1:new Image,suelo_2_2:new Image,suelo_2_3:new Image,suelo_2_4:new Image,suelo_3_0:new Image,suelo_3_1:new Image,suelo_3_2:new Image,suelo_3_3:new Image,suelo_3_4:new Image},tilesetArbol_1:new Image,tilesetArbol_2:new Image,tilesetArbusto_1:new Image,tilesetArbusto_2:new Image,tilesetCascada:{cascada_1:new Image,cascada_2:new Image,cascada_3:new Image,cascada_4:new Image,cascada_5:new Image}}}get gravedad(){return this._gravedad}set gravedad(o){this._gravedad=o}get controles(){return this._controles}async cargarAssets(){var o=[this.cargarImagenesFondo(),this.cargarTileset(),this.cargarAudios(),this.cargarImagenJugador(),this.cargarImagenesEnemigos(),this.cargarImagenesAyuda()],o=await Promise.all(o);return o&&(this.cargarEscenario(),this.cargarAyuda(),this.cargarPersonaje(),this.escucharEventos()),o}cargarEscenario(){this.fondo=new u({posicion:{x:0,y:0},velocidad:{x:0,y:0},imagenes:this.imagenesFondo,contadorLimiteCuadros:48,escenario:new d({plataformas:[new l({posicion:{x:Math.round(800*this.proporcionResolucion),y:Math.floor(q.height-Math.floor(300*this.proporcionResolucion))},width:Math.floor(1536*this.proporcionResolucion),imagenes:this.tilesetEscenario,offset:{x:16,y:28}})]})})}cargarPersonaje(){this.personaje=new m({posicion:{x:this.fondo.escenario.plataformas[0].posicion.x+50,y:0},velocidad:{x:0,y:0},offset:{x:20*this.proporciones.personaje,y:0},imagenes:this.tilesetJugador,ataques:[]})}cargarAyuda(){this.ayuda=new e({posicion:{x:q.width/2-this.imagenesAyuda.abrirLibro.frame_1.width/2*this.proporciones.ayuda.libro,y:q.height/2-this.imagenesAyuda.abrirLibro.frame_1.height/2*this.proporciones.ayuda.libro},velocidad:{x:0,y:0},offset:{x:20*this.proporciones.personaje,y:0},imagenes:this.imagenesAyuda,ataques:[]})}escucharEventos(){document.addEventListener("keydown",this.moverJugador.bind(this)),document.addEventListener("keyup",this.detenerJugador.bind(this)),window.addEventListener("blur",this.detenerAcciones.bind(this)),this.audios.audioFondo.addEventListener("ended",function(){this.gameStart||(this.audios.audioFondo.volume=.3,this.audios.audioFondo.play())}.bind(this)),this.audios.audioFondo_2.addEventListener("ended",function(){this.gameStart&&(this.audios.audioFondo_2.volume=.3,this.audios.audioFondo_2.play())}.bind(this)),this.audios.audioViento.addEventListener("ended",function(){this.gameStart&&(this.audios.audioViento.volume=.3,this.audios.audioViento.play())}.bind(this)),document.addEventListener("mousemove",function(){this.gameStart||(this.audios.audioFondo.volume=.3,this.audios.audioFondo.play())}.bind(this))}detenerAcciones(){Object.keys(this.controles).forEach(o=>{this.controles[o].presionada=!1})}reproducirMusicaFondo(){this.gameStart&&(this.audios.audioFondo.pause(),this.audios.audioFondo_2.volume=.3,this.audios.audioFondo_2.play(),this.audios.audioViento.volume=.3,this.audios.audioViento.play())}moverJugador(o){this.gameStart&&0<this.personaje.vida&&this.controles[o.key]&&("ArrowUp"!==o.key&&"w"!=o.key||this.personaje.velocidad.y>=V.gravedad&&(this.controles[o.key].presionada||(this.personaje.dobleSalto&&this.personaje.saltando&&(this.personaje.velocidad.y=-this.saltoPersonaje,this.personaje.dobleSalto=!1),this.personaje.saltando)||(this.personaje.saltando=!0,this.personaje.velocidad.y=-this.saltoPersonaje,this.personaje.dobleSalto=!0))," "===o.key&&0<this.personaje.energia&&(this.controles[o.key].presionada||(this.personaje.realizandoAtaque=!0,this.personaje.crearAtaque(),this.personaje.velocidad.x=0,--this.personaje.energia)),this.controles[o.key].presionada=!0)}detenerJugador(o){this.controles[o.key]&&(o.key,this.controles[o.key].presionada=!1)}async cargarTileset(){this.tilesetEscenario.tileset.src="/assets/img/fondo/tilesets/tileset.png",this.tilesetEscenario.tilesetArbol_1.src="/assets/img/fondo/tilesets/tileset-arbol-1.png",this.tilesetEscenario.tilesetArbol_2.src="/assets/img/fondo/tilesets/tileset-arbol-2.png",this.tilesetEscenario.tilesetArbusto_1.src="/assets/img/fondo/tilesets/tileset-arbusto-1.png",this.tilesetEscenario.tilesetArbusto_2.src="/assets/img/fondo/tilesets/tileset-arbusto-2.png",this.tilesetEscenario.tilesetSuelo.suelo_0_0.src="/assets/img/fondo/tilesets/tileset-suelo-0-0.png",this.tilesetEscenario.tilesetSuelo.suelo_0_1.src="/assets/img/fondo/tilesets/tileset-suelo-0-1.png",this.tilesetEscenario.tilesetSuelo.suelo_0_2.src="/assets/img/fondo/tilesets/tileset-suelo-0-2.png",this.tilesetEscenario.tilesetSuelo.suelo_0_3.src="/assets/img/fondo/tilesets/tileset-suelo-0-3.png",this.tilesetEscenario.tilesetSuelo.suelo_0_4.src="/assets/img/fondo/tilesets/tileset-suelo-0-4.png",this.tilesetEscenario.tilesetSuelo.suelo_1_0.src="/assets/img/fondo/tilesets/tileset-suelo-1-0.png",this.tilesetEscenario.tilesetSuelo.suelo_1_1.src="/assets/img/fondo/tilesets/tileset-suelo-1-1.png",this.tilesetEscenario.tilesetSuelo.suelo_1_2.src="/assets/img/fondo/tilesets/tileset-suelo-1-2.png",this.tilesetEscenario.tilesetSuelo.suelo_1_3.src="/assets/img/fondo/tilesets/tileset-suelo-1-3.png",this.tilesetEscenario.tilesetSuelo.suelo_1_4.src="/assets/img/fondo/tilesets/tileset-suelo-1-4.png",this.tilesetEscenario.tilesetSuelo.suelo_2_0.src="/assets/img/fondo/tilesets/tileset-suelo-2-0.png",this.tilesetEscenario.tilesetSuelo.suelo_2_1.src="/assets/img/fondo/tilesets/tileset-suelo-2-1.png",this.tilesetEscenario.tilesetSuelo.suelo_2_2.src="/assets/img/fondo/tilesets/tileset-suelo-2-2.png",this.tilesetEscenario.tilesetSuelo.suelo_2_3.src="/assets/img/fondo/tilesets/tileset-suelo-2-3.png",this.tilesetEscenario.tilesetSuelo.suelo_2_4.src="/assets/img/fondo/tilesets/tileset-suelo-2-4.png",this.tilesetEscenario.tilesetSuelo.suelo_3_0.src="/assets/img/fondo/tilesets/tileset-suelo-3-0.png",this.tilesetEscenario.tilesetSuelo.suelo_3_1.src="/assets/img/fondo/tilesets/tileset-suelo-3-1.png",this.tilesetEscenario.tilesetSuelo.suelo_3_2.src="/assets/img/fondo/tilesets/tileset-suelo-3-2.png",this.tilesetEscenario.tilesetSuelo.suelo_3_3.src="/assets/img/fondo/tilesets/tileset-suelo-3-3.png",this.tilesetEscenario.tilesetSuelo.suelo_3_4.src="/assets/img/fondo/tilesets/tileset-suelo-3-4.png",this.tilesetEscenario.tilesetCascada.cascada_1.src="/assets/img/fondo/cascada/cascada-1-test.png",this.tilesetEscenario.tilesetCascada.cascada_2.src="/assets/img/fondo/cascada/cascada-2-test.png",this.tilesetEscenario.tilesetCascada.cascada_3.src="/assets/img/fondo/cascada/cascada-3-test.png",this.tilesetEscenario.tilesetCascada.cascada_4.src="/assets/img/fondo/cascada/cascada-4-test.png",this.tilesetEscenario.tilesetCascada.cascada_5.src="/assets/img/fondo/cascada/cascada-5-test.png";let o=Object.values(this.tilesetEscenario).reduce((o,i)=>(i instanceof Image?o.push(i):o.push(...Object.values(i)),o),[]);return o=o.map(o=>new Promise((i,a)=>{o.addEventListener("load",o=>i(o.target)),o.addEventListener("error",o=>a(o.target))})),await Promise.all(o)}async cargarImagenesAyuda(){this.imagenesAyuda.abrirLibro.frame_1.src="/assets/img/ayuda/libro/abrir-libro/1.png",this.imagenesAyuda.abrirLibro.frame_2.src="/assets/img/ayuda/libro/abrir-libro/2.png",this.imagenesAyuda.abrirLibro.frame_3.src="/assets/img/ayuda/libro/abrir-libro/3.png",this.imagenesAyuda.abrirLibro.frame_4.src="/assets/img/ayuda/libro/abrir-libro/4.png",this.imagenesAyuda.abrirLibro.frame_5.src="/assets/img/ayuda/libro/abrir-libro/5.png",this.imagenesAyuda.abrirLibro.frame_6.src="/assets/img/ayuda/libro/abrir-libro/6.png",this.imagenesAyuda.abrirLibro.frame_7.src="/assets/img/ayuda/libro/abrir-libro/7.png",this.imagenesAyuda.abrirLibro.frame_8.src="/assets/img/ayuda/libro/abrir-libro/8.png",this.imagenesAyuda.cerrarLibro.frame_1.src="/assets/img/ayuda/libro/cerrar-libro/1.png",this.imagenesAyuda.cerrarLibro.frame_2.src="/assets/img/ayuda/libro/cerrar-libro/2.png",this.imagenesAyuda.cerrarLibro.frame_3.src="/assets/img/ayuda/libro/cerrar-libro/3.png",this.imagenesAyuda.cerrarLibro.frame_4.src="/assets/img/ayuda/libro/cerrar-libro/4.png",this.imagenesAyuda.cerrarLibro.frame_5.src="/assets/img/ayuda/libro/cerrar-libro/5.png",this.imagenesAyuda.cerrarLibro.frame_6.src="/assets/img/ayuda/libro/cerrar-libro/6.png",this.imagenesAyuda.cerrarLibro.frame_7.src="/assets/img/ayuda/libro/cerrar-libro/7.png",this.imagenesAyuda.cerrarLibro.frame_8.src="/assets/img/ayuda/libro/cerrar-libro/8.png",this.imagenesAyuda.botonArriba.frame_1.src="/assets/img/ayuda/iconos/boton-arriba-1.png",this.imagenesAyuda.botonArriba.frame_2.src="/assets/img/ayuda/iconos/boton-arriba-2.png",this.imagenesAyuda.botonDerecha.frame_1.src="/assets/img/ayuda/iconos/boton-derecha-1.png",this.imagenesAyuda.botonDerecha.frame_2.src="/assets/img/ayuda/iconos/boton-derecha-2.png",this.imagenesAyuda.botonIzquierda.frame_1.src="/assets/img/ayuda/iconos/boton-izquierda-1.png",this.imagenesAyuda.botonIzquierda.frame_2.src="/assets/img/ayuda/iconos/boton-izquierda-2.png",this.imagenesAyuda.botonW.frame_1.src="/assets/img/ayuda/iconos/boton-w-1.png",this.imagenesAyuda.botonW.frame_2.src="/assets/img/ayuda/iconos/boton-w-2.png",this.imagenesAyuda.botonA.frame_1.src="/assets/img/ayuda/iconos/boton-a-1.png",this.imagenesAyuda.botonA.frame_2.src="/assets/img/ayuda/iconos/boton-a-2.png",this.imagenesAyuda.botonD.frame_1.src="/assets/img/ayuda/iconos/boton-d-1.png",this.imagenesAyuda.botonD.frame_2.src="/assets/img/ayuda/iconos/boton-d-2.png",this.imagenesAyuda.botonEspacio.frame_1.src="/assets/img/ayuda/iconos/boton-espacio-1.png",this.imagenesAyuda.botonEspacio.frame_2.src="/assets/img/ayuda/iconos/boton-espacio-2.png",this.imagenesAyuda.botonCerrar.src="/assets/img/ayuda/iconos/boton-cerrar.png",this.imagenesAyuda.botonCheck.src="/assets/img/ayuda/iconos/boton-check.png",this.imagenesAyuda.botonUncheck.src="/assets/img/ayuda/iconos/boton-uncheck.png";let o=Object.values(this.imagenesAyuda).reduce((i,o)=>(o instanceof Image?i.push(o):Object.values(o).forEach(o=>{i.push(o)}),i),[]);return o=o.map(o=>new Promise((i,a)=>{o.addEventListener("load",o=>i(o.target)),o.addEventListener("error",o=>a(o.target))})),await Promise.all(o)}async cargarImagenesFondo(){this.imagenesFondo.fondo.src="/assets/img/fondo/montañas/Background.png",this.imagenesFondo.montaña_1.frame_1.src="assets/img/fondo/montañas/Layer 1 anim1.png",this.imagenesFondo.montaña_1.frame_2.src="/assets/img/fondo/montañas/Layer 1 anim2.png",this.imagenesFondo.montaña_2.frame_1.src="/assets/img/fondo/montañas/Layer 2 anim1.png",this.imagenesFondo.montaña_2.frame_2.src="/assets/img/fondo/montañas/Layer 2 anim2.png",this.imagenesFondo.montaña_3.frame_1.src="/assets/img/fondo/montañas/Layer 3 anim1.png",this.imagenesFondo.montaña_3.frame_2.src="/assets/img/fondo/montañas/Layer 3 anim2.png",this.imagenesFondo.montaña_4.frame_1.src="/assets/img/fondo/montañas/Layer 4 anim1.png",this.imagenesFondo.montaña_4.frame_2.src="/assets/img/fondo/montañas/Layer 4 anim2.png",this.imagenesFondo.montaña_5.frame_1.src="/assets/img/fondo/montañas/Layer 6 anim1.png",this.imagenesFondo.montaña_5.frame_2.src="/assets/img/fondo/montañas/Layer 6 anim2.png",this.imagenesFondo.nube_1.frame_1.src="/assets/img/fondo/montañas/Layer 1 clound anim1.png",this.imagenesFondo.nube_1.frame_2.src="/assets/img/fondo/montañas/Layer 1 clound anim2.png",this.imagenesFondo.nube_2.frame_1.src="/assets/img/fondo/montañas/Layer 3 clound anim1.png",this.imagenesFondo.nube_2.frame_2.src="/assets/img/fondo/montañas/Layer 3 clound anim2.png",this.imagenesFondo.nube_3.frame_1.src="/assets/img/fondo/montañas/Layer 5 anim1.png",this.imagenesFondo.nube_3.frame_2.src="/assets/img/fondo/montañas/Layer 5 anim2.png";let o=Object.values(this.imagenesFondo).reduce((o,i)=>(i instanceof Image?o.push(i):(i.frame_1&&i.frame_1 instanceof Image&&o.push(i.frame_1),i.frame_2&&i.frame_2 instanceof Image&&o.push(i.frame_2),i.frame_3&&i.frame_3 instanceof Image&&o.push(i.frame_3),i.frame_4&&i.frame_4 instanceof Image&&o.push(i.frame_4),i.frame_5&&i.frame_5 instanceof Image&&o.push(i.frame_5)),o),[]);return o=o.map(o=>new Promise((i,a)=>{o.addEventListener("load",o=>i(o.target)),o.addEventListener("error",o=>a(o.target))})),await Promise.all(o)}async cargarImagenJugador(){this.tilesetJugador.tileset.src="/assets/img/personaje/personaje-2.png",this.tilesetJugador.contenedorEnergia.src="/assets/img/personaje/estadisticas/contenedor-energia.png",this.tilesetJugador.contenedorVida.src="/assets/img/personaje/estadisticas/contenedor-vida.png",this.tilesetJugador.barraEnergia.src="/assets/img/personaje/estadisticas/barra-energia.png",this.tilesetJugador.barraVida.src="/assets/img/personaje/estadisticas/barra-vida.png",this.tilesetJugador.tilesetVida.src="/assets/img/personaje/estadisticas/vida.png",this.tilesetJugador.tilesetEnergia.src="/assets/img/personaje/estadisticas/energia.png",this.tilesetJugador.tilesetPuntuacion.src="/assets/img/personaje/estadisticas/puntuacion.png",this.tilesetJugador.bolaFuego.src="/assets/img/personaje/ataque/bola-fuego-2.png",this.tilesetJugador.impactoAtaque.src="/assets/img/personaje/ataque/impacto-ataque-3.png";let o=Object.values(this.tilesetJugador).reduce((o,i)=>(i instanceof Image&&o.push(i),o),[]);return o=o.map(o=>new Promise((i,a)=>{o.addEventListener("load",o=>i(o.target)),o.addEventListener("error",o=>a(o.target))})),await Promise.all(o)}async cargarImagenesEnemigos(){this.imagenesEnemigos.samurai.src="/assets/img/enemigos/enemigo-1/samurai.png",this.imagenesEnemigos.muerte.src="/assets/img/enemigos/muerte/humo-1.png",this.imagenesEnemigos.jabali.src="/assets/img/enemigos/enemigo-3/jabali.png",this.imagenesEnemigos.caballeroOscuro.src="/assets/img/enemigos/enemigo-5/caballero-oscuro.png",this.imagenesEnemigos.minotauro.src="/assets/img/enemigos/enemigo-4/minotauro.png",this.imagenesEnemigos.pocion.src="/assets/img/items/pocion.png";let o=Object.values(this.tilesetJugador).reduce((o,i)=>(i instanceof Image&&o.push(i),o),[]);return o=o.map(o=>new Promise((i,a)=>{o.addEventListener("load",o=>i(o.target)),o.addEventListener("error",o=>a(o.target))})),await Promise.all(o)}async cargarAudios(){this.audios={audioFondo:new Audio("./assets/audio/audio-fondo.ogg"),audioViento:new Audio("./assets/audio/audio-viento.mp3"),audioFondo_2:new Audio("./assets/audio/audio-fondo-2.ogg")};let o=Object.values(this.imagenesFondo).reduce((o,i)=>(i instanceof Audio&&o.push(i),o),[]);return o=o.map(o=>new Promise((i,a)=>{o.addEventListener("load",o=>i(o.target)),o.addEventListener("error",o=>a(o.target))})),await Promise.all(o)}iniciar(){this.idAnimation=requestAnimationFrame(o=>this.animar(o))}animar(o){this.deltaTiempo=o-this.ultimoTiempo,this.contadorFps++,this.contadorTiempoFps+=this.deltaTiempo,this.ultimoTiempo=o,D.clearRect(0,0,q.width,q.height),1e3<=this.contadorTiempoFps&&(this.fps=this.contadorFps,this.contadorFps=0,this.contadorTiempoFps=0,this.definirProporciones(),this.contadorSeg++,D.fillText(this.fps+"fps",0,0)),this.fondo.actualizarSprite(this.deltaTiempo),this.gameStart&&(this.personaje.actualizarSprite(this.deltaTiempo),sessionStorage.getItem("ocultarAyuda")||this.ayuda.actualizarSprite()),this.gameOver||(this.idAnimation=requestAnimationFrame(o=>this.animar(o)))}definirProporciones(){140<=this.fps&&!this.establecerFPS?(2<=this.contadorSeg&&(this.establecerFPS=!0),this.proporcionesFPS.proporcionLimiteCuadros=Math.round(1),this.proporcionesFPS.proporcionMovimiento=Math.round(1),this.proporcionesFPS.proporcionMovimientoEnemigo=Math.round(1),this.proporcionesFPS.proporcionSalto=Math.round(.9939759036144579),this.gravedad=72/this.fps,this.saltoPersonaje=M(q.height*F(M(410,this.gravedad))/1333),q.width<=1920&&1366<q?(this.proporcionesFPS.proporcionLimiteCuadros=1,this.proporcionesFPS.proporcionMovimiento=1,this.proporcionesFPS.proporcionMovimientoEnemigo=1,this.proporcionesFPS.proporcionSalto=1):q.width<=1366&&(this.proporcionesFPS.proporcionLimiteCuadros=1,this.proporcionesFPS.proporcionMovimiento=.7,this.proporcionesFPS.proporcionMovimientoEnemigo=.7,this.proporcionesFPS.proporcionSalto=.7)):80<=this.fps&&this.fps<140&&!this.establecerFPS?(2<=this.contadorSeg&&(this.establecerFPS=!0),q.height<600||q.height<973?this.gravedad=.5:this.gravedad=.7,this.saltoPersonaje=M(q.height*F(M(410,this.gravedad))/1333),q.width<=1920&&1366<q.width?(this.proporcionesFPS.proporcionLimiteCuadros=2,this.proporcionesFPS.proporcionMovimiento=1.33,this.proporcionesFPS.proporcionMovimientoEnemigo=1.33,this.proporcionesFPS.proporcionSalto=1.33):q.width<=1366&&(this.proporcionesFPS.proporcionLimiteCuadros=2,this.proporcionesFPS.proporcionMovimiento=.9,this.proporcionesFPS.proporcionMovimientoEnemigo=.9,this.proporcionesFPS.proporcionSalto=.9)):this.fps<=80&&!this.establecerFPS&&(2<=this.contadorSeg&&(this.establecerFPS=!0),q.height<600?this.gravedad=1.6:q.height<973?this.gravedad=1.8:this.gravedad=2.3,this.saltoPersonaje=M(q.height*F(M(410,this.gravedad))/1333),q.width<=1920&&1366<q.width?(this.proporcionesFPS.proporcionLimiteCuadros=4,this.proporcionesFPS.proporcionMovimiento=2.66,this.proporcionesFPS.proporcionMovimientoEnemigo=2.66,this.proporcionesFPS.proporcionSalto=2.66):q.width<=1366&&(this.proporcionesFPS.proporcionLimiteCuadros=4,this.proporcionesFPS.proporcionMovimiento=1.8,this.proporcionesFPS.proporcionMovimientoEnemigo=1.8,this.proporcionesFPS.proporcionSalto=1.8))}finalizar(){var o;this.gameStart&&(this.gameStart=!1,o={nombre:w.value,puntuacion:parseInt(this.personaje.puntuacion)},this.cargarEscenario(),this.cargarAyuda(),this.cargarPersonaje(),this.audios.audioFondo_2.pause(),this.audios.audioFondo_2.currentTime=0,this.audios.audioFondo.currentTime=0,this.audios.audioFondo.play(),this.audios.audioViento.pause(),this.audios.audioViento.currentTime=0,i(o).then(o=>{P()}),P())}});(async()=>{await V.cargarAssets()&&V.iniciar()})();